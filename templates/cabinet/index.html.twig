{% extends 'base.html.twig' %}

{% block title %}Cabinet médical
{% endblock %}

{% block body %}
<div
	class="pt-4">
	{# ================= HEADER : CABINET ================= #}
	{% embed '_partials/_page_header.html.twig' with {
    icon: 'bi bi-gear-fill',
    title: 'Cabinet médical',
    subtitle: 'Paramètres et informations du cabinet'
} %}


{# Actions métier (gauche) : rien pour l’instant #}
{% block header_actions_left %}{% endblock %}

{# Navigation (droite) : garde Home + Retour par défaut #}{% endembed %}</div><div class="card shadow-lg border-0 rounded-4">

<div class="card-body p-4 p-md-5">

	<div id="alertBox" class="mb-3"></div>

	<div
		class="row g-4">

		{# ===================== COLONNE GAUCHE : FORM ===================== #}
		<div class="col-12 col-lg-8">

			<div class="d-flex align-items-center justify-content-between flex-wrap gap-3 mb-3">
				<div class="d-flex align-items-center gap-3">
					<div class="rounded-3 d-inline-flex align-items-center justify-content-center bg-primary text-white" style="width:44px;height:44px;">
						<i class="bi bi-gear-fill fs-5"></i>
					</div>
					<div class="lh-sm">
						<h4 class="fw-bold mb-0">Informations du cabinet</h4>
						<small class="text-muted">Mettez à jour les informations de votre établissement</small>
					</div>
				</div>

				<span class="badge bg-light text-dark border rounded-pill px-3 py-2">
					<i class="bi bi-shield-check me-1 text-primary"></i>Paramètres
				</span>
			</div>

			<div
				class="row g-3 g-md-4">

				<!-- NOM -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-building"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input id="nom" type="text" class="form-control" value="{{ cabinet.nom }}" placeholder="Nom du cabinet" required>
							<label for="nom">Nom du cabinet
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- TYPE -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-ui-checks-grid"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<select id="type" class="form-select" required>
								<option value="">-- Choisir --</option>
								<option value="Cabinet Médical" {{ cabinet.type == 'Cabinet Médical' ? 'selected' : '' }}>Cabinet Médical</option>
								<option value="Cabinet Dentaire" {{ cabinet.type == 'Cabinet Dentaire' ? 'selected' : '' }}>Cabinet Dentaire</option>
								<option value="Clinique" {{ cabinet.type == 'Clinique' ? 'selected' : '' }}>Clinique</option>
								<option value="Laboratoire d'Analyses" {{ cabinet.type == "Laboratoire d'Analyses" ? 'selected' : '' }}>Laboratoire d'Analyses</option>
								<option value="Centre Médical" {{ cabinet.type == 'Centre Médical' ? 'selected' : '' }}>Centre Médical</option>
								<option value="Radiologie" {{ cabinet.type == 'Radiologie' ? 'selected' : '' }}>Centre de Radiologie</option>
								<option value="Autre" {{ cabinet.type == 'Autre' ? 'selected' : '' }}>Autre</option>
							</select>
							<label for="type">Type d'établissement
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- ADRESSE -->
				<div class="col-md-12">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-geo-alt"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input id="adresse" type="text" class="form-control" value="{{ cabinet.adresse }}" placeholder="Adresse" required>
							<label for="adresse">Adresse
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- VILLE -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-pin-map"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input id="ville" type="text" class="form-control" value="{{ cabinet.ville }}" placeholder="Ville" required>
							<label for="ville">Ville
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- TÉLÉPHONE -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-telephone"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input id="telephone" type="text" class="form-control" value="{{ cabinet.telephone }}" placeholder="Téléphone" required>
							<label for="telephone">Téléphone
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- EMAIL -->
				<div class="col-md-12">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-envelope"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input id="email" type="email" class="form-control" value="{{ cabinet.email }}" placeholder="Email" required>
							<label for="email">Adresse email
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

			</div>

			<div class="d-flex justify-content-end mt-4">
				<button id="saveCabinet" class="btn btn-primary rounded-pill px-4 py-2 d-inline-flex align-items-center gap-2">
					<i class="bi bi-check2-circle"></i>
					Sauvegarder
				</button>
			</div>

		</div>

		{# ===================== COLONNE DROITE : ACCÈS RAPIDES ===================== #}
		<div class="col-12 col-lg-4">

			<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
				<div class="card-body p-3 p-md-4">

					<div class="d-flex align-items-center justify-content-between mb-3">
						<div class="fw-bold">
							<i class="bi bi-lightning-charge-fill text-warning me-1"></i>
							Accès rapides
						</div>
						<span class="badge bg-light text-dark border rounded-pill">Menu</span>
					</div>

					{# ✅ Bloc premium : Prestations & Tarifs #}
					<a href="{{ path('prestation_price_index') }}" class="text-decoration-none">
						<div class="p-3 rounded-4 border" style="background: linear-gradient(135deg, rgba(13,110,253,.12), rgba(13,110,253,.03));">
							<div class="d-flex align-items-center justify-content-between gap-3">
								<div class="d-flex align-items-center gap-3">
									<div class="rounded-3 d-inline-flex align-items-center justify-content-center bg-primary text-white" style="width:44px;height:44px;">
										<i class="bi bi-cash-coin fs-5"></i>
									</div>
									<div class="lh-sm">
										<div class="fw-bold text-dark">Prestations & Tarifs</div>
										<small class="text-muted">Gérer les actes et les prix</small>
									</div>
								</div>

								<span class="btn btn-primary rounded-pill px-3 py-2 d-inline-flex align-items-center gap-2">
									Ouvrir
									<i class="bi bi-arrow-right-circle"></i>
								</span>
							</div>
						</div>
					</a>

					{# (Optionnel) autres raccourcis si tu veux plus tard :
					             Symptômes, Traitements, etc. #}
					{# 
					          <div class="mt-3 d-grid gap-2">
					            <a href="{{ path('symptome_index') }}" class="btn btn-outline-primary rounded-pill">
					              <i class="bi bi-activity me-1"></i> Symptômes
					            </a>
					            <a href="{{ path('traitement_index') }}" class="btn btn-outline-primary rounded-pill">
					              <i class="bi bi-prescription2 me-1"></i> Traitements
					            </a>
					          </div>
					          #}

					<hr class="my-3">

					<div class="small text-muted">
						<i class="bi bi-info-circle me-1"></i>
						Astuce : configure d’abord tes prestations pour générer facilement tes devis/factures.
					</div>

				</div>
			</div>

		</div>

	</div>

</div>





	 <script>
	document.getElementById("saveCabinet").addEventListener("click", async () => {
	
		const alertBox = document.getElementById("alertBox");
		alertBox.innerHTML = `<div class="alert alert-info">Enregistrement...</div>`;
	
		// Validation simple
		const requiredFields = ["nom", "type", "adresse", "ville", "telephone", "email"];
		for (let id of requiredFields) {
			let el = document.getElementById(id);
			if (!el.value.trim()) {
				alertBox.innerHTML = `<div class="alert alert-danger">Veuillez remplir tous les champs obligatoires.</div>`;
				el.classList.add("is-invalid");
				return;
			} else {
				el.classList.remove("is-invalid");
			}
		}
	
		const payload = {
			nom: nom.value,
			type: type.value,
			adresse: adresse.value,
			ville: ville.value,
			telephone: telephone.value,
			email: email.value,
		};
	
		const response = await fetch("{{ path('app_cabinet_save') }}", {
			method: "POST",
			headers: { "Content-Type": "application/json" },
			body: JSON.stringify(payload)
		});
	
		const result = await response.json();
	
		if (result.success) {
			alertBox.innerHTML = `<div class="alert alert-success">${result.message}</div>`;
majLogo();

		} else {
			alertBox.innerHTML = `<div class="alert alert-danger">${result.error}</div>`;
		}
	});
	</script>

{% endblock %}

