<div class="modal fade" id="certificatModal" tabindex="-1" aria-labelledby="certificatModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<div
			class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">

			<!-- Header -->
			<div class="modal-header bg-light border-0 px-4 py-3">
				<div class="d-flex align-items-center gap-3">
					<div class="rounded-3 d-inline-flex align-items-center justify-content-center bg-success text-white" style="width:42px;height:42px;">
						<i class="bi bi-file-earmark-medical fs-5"></i>
					</div>
					<div class="lh-sm">
						<h5 class="modal-title mb-0 fw-semibold" id="certificatModalLabel">Certificat m√©dical</h5>
						<small class="text-muted">R√©diger ou modifier un certificat</small>
					</div>
				</div>

				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
			</div>

			<form id="certificat-form">
				<div class="modal-body px-4 py-4">
					<input type="hidden" id="certificat_id">

					<div class="mb-3">
						<label class="form-label fw-medium" for="titre">Titre
							<span class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text bg-white">
								<i class="bi bi-type"></i>
							</span>
							<input type="text" class="form-control" id="titre" placeholder="Ex : Certificat d‚Äôaptitude" required>
						</div>
					</div>

					<div class="mb-2">
						<label class="form-label fw-medium" for="contenu">Contenu
							<span class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text bg-white align-items-start pt-2">
								<i class="bi bi-card-text"></i>
							</span>
							<textarea class="form-control" id="contenu" rows="10" style="resize:none;" placeholder="√âcris le contenu du certificat ici..." required></textarea>
						</div>
						<div class="form-text">
							Astuce : tu peux utiliser des lignes courtes et des paragraphes pour une meilleure lecture.
						</div>
					</div>
				</div>

				<!-- Footer -->
				<div class="modal-footer border-0 px-4 pb-4 pt-0 d-flex gap-2 justify-content-end">
					<button type="button" class="btn btn-light rounded-pill px-4" data-bs-dismiss="modal">
						Annuler
					</button>
					<button type="submit" class="btn btn-success rounded-pill px-4 text-light">
						<i class="bi bi-check2-circle me-1"></i>
						Enregistrer
					</button>
				</div>
			</form>

		</div>
	</div>
</div>



 <script>
let certificatModal;
let certificatForm;

document.addEventListener('DOMContentLoaded', () => {
    certificatModal = new bootstrap.Modal(document.getElementById('certificatModal'));
    certificatForm = document.getElementById('certificat-form');

    certificatForm.addEventListener('submit', saveCertificat);
});

/**
 * ‚ûï Ouvrir modal cr√©ation
 */
function openCreateCertificat() {
    document.getElementById('certificat_id').value = '';
    document.getElementById('titre').value = '';
    document.getElementById('contenu').value = '';

    document.querySelector('#certificatModal .modal-title').innerText =
        'Ajouter un certificat m√©dical';

    certificatModal.show();
}

/**
 * ‚úèÔ∏è Ouvrir modal √©dition
 */
function openEditCertificat(id) {
    fetch(`/certificats/api/${id}`)
        .then(response => response.json())
        .then(data => {
            document.getElementById('certificat_id').value = data.id;
            document.getElementById('titre').value = data.titre;
            document.getElementById('contenu').value = data.contenu;

            document.querySelector('#certificatModal .modal-title').innerText =
                'Modifier le certificat m√©dical';

            certificatModal.show();
        })
        .catch(() => alert('Erreur lors du chargement'));
}

/**
 * üíæ Enregistrer (CREATE / UPDATE)
 */
function saveCertificat(e) {
    e.preventDefault();

    const formData = new FormData();
    formData.append('id', document.getElementById('certificat_id').value);
    formData.append('titre', document.getElementById('titre').value);
    formData.append('contenu', document.getElementById('contenu').value);

    fetch('/certificats/save', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(() => {
        certificatModal.hide();
        reloadCertificatList();
    })
    .catch(() => alert('Erreur lors de l‚Äôenregistrement'));
}

/**
 * üóëÔ∏è Supprimer
 */
function deleteCertificat(id) {
    if (!confirm('Supprimer ce certificat m√©dical ?')) return;

    fetch(`/certificats/delete/${id}`, {
        method: 'DELETE'
    })
    .then(response => response.json())
    .then(() => reloadCertificatList())
    .catch(() => alert('Erreur lors de la suppression'));
}

/**
 * üîÑ Recharger la liste (AJAX)
 */
function reloadCertificatList() {
    fetch('/certificats/')
        .then(response => response.text())
        .then(html => {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newList = doc.querySelector('#certificat-list');

            document.querySelector('#certificat-list').innerHTML =
                newList.innerHTML;
        });
}
</script>

