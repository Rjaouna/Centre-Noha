<!-- MODAL AJOUT DOSSIER -->
<div class="modal fade" id="modalAddDossier" tabindex="-1">
	<div class="modal-dialog modal-lg">
		<div
			class="modal-content rounded-4 shadow-lg">

			<!-- HEADER -->
			<div class="modal-header bg-primary text-white rounded-top-4">
				<h5 class="modal-title fw-bold">
					<i class="bi bi-folder-plus me-2"></i>
					Nouveau dossier médical
				</h5>
				<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			</div>

			<!-- BODY -->
			<div class="modal-body p-4">
				<form id="formAddDossier">

					<input type="hidden" id="patient_id" value="{{ patient.id }}">

					<!-- ----------------------------- -->
					<!--     CHOIX MOTIF DOCTOLIB      -->
					<!-- ----------------------------- --><h6 class="fw-bold mb-3"> Motif de consultation</h6>

					<div class="docto-grid">

						<label class="docto-option">
							<input type="radio" name="motif" value="sante_mentale">
							<div class="docto-content">
<img src="{{asset('assets/img/unhappiness_anxiety.a365c3f.png')}}" height="48">


								<div>
									<div class="docto-title">Santé mentale</div>
									<div class="docto-desc">Mal-être, anxiété, stress…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="fievre">
							<div class="docto-content">
<img src="{{asset('assets/img/fever.23b4eaa.png')}}" height="48">




								<div>
									<div class="docto-title">Fièvre</div>
									<div class="docto-desc">Température, frissons…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="rhume">
							<div class="docto-content">
<img src="{{asset('assets/img/cold.c695c4b.png')}}" height="48">



								<div>
									<div class="docto-title">Rhume</div>
									<div class="docto-desc">Toux, nez bouché…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="maux_gorge">
							<div class="docto-content">
<img src="{{asset('assets/img/sore_throat.8470dea.png')}}" height="48">



								<div>
									<div class="docto-title">Maux de gorge</div>
									<div class="docto-desc">Douleur, irritation…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="renouvellement_traitement">
							<div class="docto-content">
<img src="{{asset('assets/img/prescription_renewal.642ea0e.png')}}" height="48">



								<div>
									<div class="docto-title">Renouvellement / réévaluation</div>
									<div class="docto-desc">Ordonnance, suivi traitement.</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="consultation_suivi">
							<div class="docto-content">
<img src="{{asset('assets/img/follow_up_consultation.4252df6.png')}}" height="48">



								<div>
									<div class="docto-title">Consultation de suivi</div>
									<div class="docto-desc">Lecture de résultats…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="troubles_digestifs">
							<div class="docto-content">
<img src="{{asset('assets/img/digestive_disorders.2ad3b67.png')}}" height="48">



								<div>
									<div class="docto-title">Troubles digestifs</div>
									<div class="docto-desc">Diarrhée, douleurs…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="gene_urinaire">
							<div class="docto-content">
<img src="{{asset('assets/img/urinary_discomfort.59e5fe8.png')}}" height="48">



								<div>
									<div class="docto-title">Gêne urinaire</div>
									<div class="docto-desc">Brûlures, gêne…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="douleur_dos">
							<div class="docto-content">
<img src="{{asset('assets/img/back_pain.afa5b94.png')}}" height="48">



								<div>
									<div class="docto-title">Douleur au dos</div>
									<div class="docto-desc">Blocage, lombalgie…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="symptomes_allergiques">
							<div class="docto-content">
<img src="{{asset('assets/img/allergic_symptoms.9ed0379.png')}}" height="48">



								<div>
									<div class="docto-title">Symptômes allergiques</div>
									<div class="docto-desc">Démangeaisons, éternuements…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="gynecologie">
							<div class="docto-content">
<img src="{{asset('assets/img/gynecology.4337453.png')}}" height="48">



								<div>
									<div class="docto-title">Gynécologie</div>
									<div class="docto-desc">Grossesse, règles…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="probleme_peau">
							<div class="docto-content">
<img src="{{asset('assets/img/skin_problems.e9e7d3f.png')}}" height="48">



								<div>
									<div class="docto-title">Problème de peau</div>
									<div class="docto-desc">Éruptions, plaques…</div>
								</div>
							</div>
						</label>

						<label class="docto-option">
							<input type="radio" name="motif" value="maux_tete">
							<div class="docto-content">
<img src="{{asset('assets/img/headaches.e9972ce.png')}}" height="48">




								<div>
									<div class="docto-title">Maux de tête</div>
									<div class="docto-desc">Céphalées, migraine…</div>
								</div>
							</div>
						</label>

					</div>

					<!-- DESCRIPTION -->
					<div class="form-floating mt-4 mb-3">
						<textarea id="dossier_description" class="form-control" style="height:120px;" placeholder="Description"></textarea>
						<label for="dossier_description">Description</label>
					</div>

					<!-- BOUTON -->
					<button id="addDossier" class="btn btn-primary w-100 rounded-pill py-2">
						<i class="bi bi-check-circle"></i>
						Enregistrer
					</button>

				</form>
			</div>

		</div>
	</div>
</div>

<!-- CSS DOCTOLIB -->
<style>
	.docto-grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(230px, 1fr));
		gap: 15px;
	}

	.docto-option {
		border: 2px solid #ddd;
		padding: 12px;
		border-radius: 14px;
		display: flex;
		cursor: pointer;
		transition: 0.2s;
		background: #fff;
	}

	.docto-option:hover {
		border-color: #0d6efd;
	}

	.docto-option input {
		display: none;
	}

	.docto-option input:checked + .docto-content {
		background: #e7f1ff;
		border-radius: 12px;
		border: 2px solid #0d6efd;
	}

	.docto-content {
		display: flex;
		gap: 12px;
		width: 100%;
	}

	.docto-title {
		font-weight: bold;
		font-size: 1rem;
	}
	.docto-desc {
		font-size: 0.8rem;
		color: #555;
	}
</style>

<!-- SCRIPT -->
 <script>
document.addEventListener("DOMContentLoaded", () => {

    const form = document.getElementById("formAddDossier");
    const modal = new bootstrap.Modal(document.getElementById("modalAddDossier"));
    const addDossier = document.querySelector("#addDossier");

    form.addEventListener("submit", async e => {
        e.preventDefault();

        const motif = document.querySelector('input[name="motif"]:checked');
        if (!motif) {
            alert("Veuillez sélectionner un motif.");
            return;
        }

        const payload = {
            titre: motif.value,
            description: document.getElementById("dossier_description").value
        };

        const apiUrl = `{{ path('api_dossier_medical_create', { id: patient.id }) }}`;

        addDossier.disabled = true;
let seconds = 1;



        addDossier.innerHTML = `<span class="spinner-border spinner-border-sm me-2"></span>Création... (${seconds}s)`;

        const countdown = setInterval(() => {
            seconds--;
            addDossier.innerHTML = `<span class="spinner-border spinner-border-sm me-2"></span>Création... (${seconds}s)`;

            if (seconds <= 0) {
                clearInterval(countdown);
                form.reset();
                modal.hide();

                addDossier.innerHTML = `<i class="bi bi-check-circle"></i> Enregistrer`;
                addDossier.disabled = false;
            }
        }, 1000);

        await fetch(apiUrl, {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer " + localStorage.getItem("jwt_token")
            },
            body: JSON.stringify(payload)
        });
    });

});
</script>

