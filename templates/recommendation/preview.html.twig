{% extends 'base.html.twig' %}

{% block title %}
	{{ hopital.etablissement }}
	- Ã‰tablissement hospitalier
{% endblock %}

{% block body %}

	<style>
		body {
			font-family: Helvetica, Arial, sans-serif;
			line-height: 1.6;
			font-size: 13px;
		}

		/* Conteneur centrÃ© */
		.pdf-wrapper {
			display: flex;
			justify-content: center;
			margin-top: 30px;
			margin-bottom: 50px;
		}

		.pdf-container {
			width: 100%;
			max-width: 650px; /* ðŸ‘ˆ plus Ã©troit et centrÃ© */
			background: white;
			padding: 40px 50px;
			border-radius: 12px;
			box-shadow: 0 5px 25px rgba(0, 0, 0, 0.12);
		}

		.header {
			text-align: right;
			margin-bottom: 40px;
		}

		.title {
			font-size: 22px;
			font-weight: bold;
			text-align: center;
			margin-bottom: 25px;
			text-decoration: underline;
		}

		.bloc {
			margin-bottom: 20px;
		}

		/* Bas de page */
		.footer {
			margin-top: 40px;
			padding-top: 12px;
			border-top: 1px solid #ccc;
			text-align: center;
			font-size: 12px;
			color: #555;
			line-height: 1.4;
		}
	</style>


	<div class="mt-4">

		<div class="card shadow-lg border-0 rounded-4 mb-4">
			<div class="card-body py-4 px-4">

				<div
					class="row align-items-center">

					<!-- TITRE -->
					<div class="col-12 col-md-7 d-flex align-items-center mb-3 mb-md-0">
						<i class="bi bi-pen text-primary fs-1 me-3"></i>

						<div>
							<h2 class="fw-bold text-primary mb-1">Nouvelle recommandation</h2>
						</div>
					</div>

					<!-- BOUTONS -->
					<div class="col-12 col-md-5 d-flex flex-column flex-md-row gap-2">

						<button onclick="generatePdf(this)" class="btn btn-outline-danger btn-lg rounded-pill clic px-4 shadow-sm d-flex align-items-center gap-2 w-100 w-md-auto">
							<i class="bi bi-filetype-pdf"></i>
							GÃ©nÃ©rer le PDF
						</button>

						<a id="returnButtonShow" href="{{ path('app_home') }}" class="btn btn-outline-secondary btn-lg rounded-pill clic px-4 shadow-sm d-flex align-items-center gap-2 w-100 w-md-auto">
							<i class="bi bi-arrow-left"></i>
							Retour
						</a>

					</div>

				</div>

			</div>
		</div>

	</div>


	<div class="pdf-wrapper">
		<div
			class="pdf-container">

			<!-- DATE DU JOUR -->
			<div class="header">
				<strong>{{ "now"|date("d/m/Y") }}</strong>
			</div>

			<!-- TITRE -->
			<div class="title">Lettre de Recommandation</div>

			<p>
				Je soussignÃ©(e),
				<strong>{{ cabinet.nom }}</strong>,
					            professionnel de santÃ©, recommande vivement mon patient :
			</p>

			<!-- PATIENT -->
			<div class="bloc">
				<strong>{{ patient.nom }}</strong><br>

				NÃ©(e) le :
<strong>{{ patient.age ? patient.age|date("d/m/Y") : "â€”" }}</strong><br>


{% if patient.age %}

{% set diff = date().diff(patient.age) %}

					Ã‚ge :
					<strong>
						{% if diff.y >= 1 %}
							{{ diff.y }}
							ans
						{% elseif diff.m >= 1 %}
							{{ diff.m }}
							mois
						{% else %}
							{{ diff.d }}
							jours
						{% endif %}
					</strong><br>
				{% endif %}

				TÃ©lÃ©phone :
				{{ patient.telephone ?? '-' }}
			</div>

			<!-- HÃ”PITAL -->
			<p>Pour une prise en charge au sein de lâ€™Ã©tablissement :</p>

			<div class="bloc">
				<strong>{{ hopital.etablissement }}</strong><br>
				Commune :
				{{ hopital.commune }}<br>
				DÃ©lÃ©gation :
				{{ hopital.delegation }}<br>
				RÃ©gion :
				{{ hopital.region }}
			</div>

			<!-- MOTIF -->
			<div class="bloc">
				<strong>Motif de recommandation :</strong><br>
				{{ motif|nl2br }}
			</div>

			<br>

			<!-- SIGNATURE -->
			<p>
				Fait le :
				<strong>{{ "now"|date("d/m/Y") }}</strong>
			</p>

			<br>

			<p>
				Cordialement,<br>
				<strong>{{ app.user.prenom }}
					{{ app.user.nom }}</strong><br>
				{{ cabinet.type }}<br>
				<strong>{{ cabinet.nom }}</strong>
			</p>

			<!-- BAS DE PAGE -->
			<div class="footer">
				{{ cabinet.nom }}
				â€”
				{{ cabinet.type }}<br>
				Adresse :
{{ cabinet.adresse ?? 'â€”' }}
{{ cabinet.ville ?? 'â€”' }}<br>

				TÃ©lÃ©phone :
				{{ cabinet.telephone ?? 'â€”' }}
				&nbsp;|&nbsp;
				            Email :
				{{ cabinet.email ?? 'â€”' }}
			</div>

		</div>
	</div>


 <script>
function generatePdf(button) {
    const patientId = "{{ patient.id }}";
    const hopitalId = "{{ hopital.id }}";
    const motif = `{{ motif|e('js') }}`;
    const encodedMotif = encodeURIComponent(motif);

    const pdfUrl = `/recommendation/pdf/${patientId}/${hopitalId}?motif=${encodedMotif}`;

    // Iframe cachÃ©
    const iframe = document.createElement("iframe");
    iframe.style.display = "none";
    iframe.src = pdfUrl;
    document.body.appendChild(iframe);

    
}


	</script>


{% endblock %}

