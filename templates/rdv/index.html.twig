{% extends 'base.html.twig' %}

{% block title %}Planning des rendez-vous
{% endblock %}

{% block body %}

	<div
		class="container-fluid mt-4">

		{# ================= HEADER ================= #}
		<div class="card shadow-lg border-0 rounded-4 mb-4">
			<div class="card-body py-4 px-4 d-flex justify-content-between align-items-center">

				<div class="d-flex align-items-center">
					<div class="icon-circle bg-primary bg-opacity-10 text-primary me-3
						                    d-flex justify-content-center align-items-center" style="width:60px;height:60px;border-radius:16px;">
						<i class="bi bi-calendar-week fs-3"></i>
					</div>

					<div>
						<h2 class="fw-bold text-primary mb-1">Planning des rendez-vous</h2>
						<p class="text-muted mb-0">Agenda m√©dical interactif</p>
					</div>
				</div>

				<button onclick="history.back()" class="btn btn-outline-primary btn-lg rounded-pill shadow-sm d-flex align-items-center gap-2">
					<i class="bi bi-arrow-left"></i>
					Retour
				</button>

			</div>
		</div>

		{# ================= CALENDAR ================= #}
		<div class="card shadow-sm border-0 rounded-4">
			<div class="card-body p-3">
				<div id="calendar"></div>
			</div>
		</div>

	</div>

{% endblock %}

{% block javascripts %}
	{{ parent() }}

	{# ================= FULLCALENDAR ================= #}
	<link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.css" rel="stylesheet">
 <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js"></script>

 <script>
document.addEventListener('DOMContentLoaded', () => {

    if (typeof FullCalendar === 'undefined') {
        console.error('‚ùå FullCalendar non charg√©');
        return;
    }

    const calendarEl = document.getElementById('calendar');
    if (!calendarEl) return;

    const calendar = new FullCalendar.Calendar(calendarEl, {

        locale: 'fr',
        initialView: 'dayGridMonth',
        height: 'auto',

        headerToolbar: {
            left: 'prev,next today',
            center: 'title',
            right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },

        slotMinTime: '08:00:00',
        slotMaxTime: '20:00:00',

        nowIndicator: true,
        navLinks: true,
        selectable: true,
        editable: false, // üîí d√©sactiv√© tant que l‚ÄôAPI move/resize n‚Äôexiste pas

        eventTimeFormat: {
            hour: '2-digit',
            minute: '2-digit',
            hour12: false
        },

        loading: function (isLoading) {
            calendarEl.style.opacity = isLoading ? '0.5' : '1';
        },

        events: {
            url: '/rdv/api/calendar',
            method: 'GET',
            failure: () => {
                alert('‚ùå Impossible de charger les rendez-vous');
            }
        },

        eventClick: function (info) {
            const clientId = info.event.extendedProps?.clientId;

            if (!clientId) {
                console.warn('Client non d√©fini pour ce RDV');
                return;
            }

            window.location.href = `/fiche/client/${clientId}`;
        },

        eventDidMount: function (info) {
            // Tooltip UX
            info.el.setAttribute(
                'title',
                `${info.event.title}\nStatut : ${info.event.extendedProps.statut ?? '‚Äî'}`
            );
        }
    });

    calendar.render();
});
</script>



{% endblock %}

