{% extends 'base.html.twig' %}

{% block title %}Mon Profil
{% endblock %}

{% block body %}

	<div
		class="mt-4">

{# ================= HEADER : PROFIL UTILISATEUR ================= #}
{% embed '_partials/_page_header.html.twig' with {
    icon: 'bi bi-person-circle',
    title: app.user.nom ? app.user.nom ~ ' ' ~ app.user.prenom : 'Profil utilisateur',
    subtitle: 'Modifier vos informations personnelles'
} %}

	{# Actions métier (optionnel) à gauche : rien ici #}
	{% block header_actions_left %}
		{# Exemple si tu veux ajouter un bouton :
		        <a href="{{ path('app_cabinet_index') }}" class="action-icon bg-outline" data-bs-toggle="tooltip" title="Paramètres">
		            <i class="bi bi-gear"></i>
		        </a>
		        #}
	{% endblock %}

	{# Navigation (droite) : on garde le default Home + Retour du partial #}
	{# Si tu veux uniquement Retour (sans Home), décommente ce bloc :
	    {% block header_actions_right %}
	        <a href="javascript:void(0);" onclick="history.back()" class="action-icon bg-light" data-bs-toggle="tooltip" title="Retour">
	            <i class="bi bi-arrow-left"></i>
	        </a>
	    {% endblock %}
	    #}

{% endembed %}


	</div>


<!-- ⭐⭐ INFOS PERSONNELLES (style cabinet : label dans l'input) ⭐⭐ -->
<div class="card border-0 shadow-sm rounded-4 overflow-hidden">
	<div class="card-body p-4 p-md-5">

		<div class="d-flex align-items-center gap-3 mb-4">
			<div class="rounded-3 d-inline-flex align-items-center justify-content-center bg-danger text-white" style="width:44px;height:44px;">
				<i class="bi bi-person-gear fs-5"></i>
			</div>
			<div class="lh-sm">
				<h4 class="fw-bold mb-0">Informations personnelles</h4>
				<small class="text-muted">Mettez à jour vos informations</small>
			</div>
		</div>

		<div id="alertBox" class="mb-3"></div>

		<form method="post">
			<div
				class="row g-3 g-md-4">

				<!-- Prénom -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-person"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input type="text" id="prenom" name="prenom" class="form-control" placeholder="Prénom" value="{{ user.prenom }}" required>
							<label for="prenom">Prénom
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- Nom -->
				<div class="col-md-6">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-person"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input type="text" id="nom" name="nom" class="form-control" placeholder="Nom" value="{{ user.nom }}" required>
							<label for="nom">Nom
								<span class="text-danger">*</span>
							</label>
						</div>
					</div>
				</div>

				<!-- Email (non modifiable) -->
				<div class="col-12">
					<div class="input-group">
						<span class="input-group-text bg-white">
							<i class="bi bi-envelope"></i>
						</span>
						<div class="form-floating flex-grow-1">
							<input type="email" id="email" class="form-control bg-light" placeholder="Adresse email" value="{{ user.email }}" disabled>
							<label for="email">Adresse email</label>
						</div>
					</div>

					<div class="d-flex align-items-start gap-2 mt-2 text-muted">
						<i class="bi bi-info-circle mt-1"></i>
						<small class="fst-italic">
							Contactez l’administrateur pour modifier votre adresse email.
						</small>
					</div>
				</div>

			</div>

			<div class="d-flex justify-content-end mt-4">
				<button class="btn btn-danger rounded-pill px-4 py-2 d-inline-flex align-items-center gap-2 text-light">
					<i class="bi bi-check2-circle"></i>
					Enregistrer
				</button>
			</div>
		</form>

		<hr class="my-4">

		<div class="d-flex justify-content-end">
			<button type="button" class="btn btn-outline-danger rounded-pill px-4 d-inline-flex align-items-center gap-2" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
				<i class="bi bi-shield-lock"></i>
				Changer mon mot de passe
			</button>
		</div>

	</div>
</div>




<div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordLabel" aria-hidden="true">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content border-0 shadow-lg rounded-4 overflow-hidden">

			<form method="post" action="{{ path('app_change_password') }}">
				<div class="modal-header bg-light border-0 px-4 py-3">
					<div class="d-flex align-items-center gap-3">
						<div class="rounded-3 d-inline-flex align-items-center justify-content-center bg-danger text-white" style="width:42px;height:42px;">
							<i class="bi bi-key fs-5"></i>
						</div>
						<div class="lh-sm">
							<h5 class="modal-title mb-0 fw-semibold" id="changePasswordLabel">Changer le mot de passe</h5>
							<small class="text-muted">Sécurisez votre compte</small>
						</div>
					</div>

					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fermer"></button>
				</div>

				<div
					class="modal-body px-4 py-4">
					<!-- Mot de passe actuel -->
					<div class="mb-3">
						<label class="form-label fw-medium">Mot de passe actuel
							<span class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text bg-white">
								<i class="bi bi-lock"></i>
							</span>
							<input type="password" name="current_password" class="form-control" required>
						</div>
					</div>

					<!-- Nouveau mot de passe -->
					<div class="mb-2">
						<label class="form-label fw-medium">Nouveau mot de passe
							<span class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text bg-white">
								<i class="bi bi-shield-lock"></i>
							</span>
							<input type="password" id="newPassword" name="new_password" class="form-control" required>
						</div>
						<small id="passwordHelp" class="text-muted">
							Minimum 8 caractères, lettres et chiffres
						</small>
					</div>

					<!-- Confirmation (cachée par défaut) -->
					<div class="mb-0 d-none" id="confirmPasswordBlock">
						<label class="form-label fw-medium mt-3">Confirmer le nouveau mot de passe
							<span class="text-danger">*</span>
						</label>
						<div class="input-group">
							<span class="input-group-text bg-white">
								<i class="bi bi-check2-circle"></i>
							</span>
							<input type="password" name="confirm_password" class="form-control" required>
						</div>
					</div>
				</div>

				<div class="modal-footer border-0 px-4 pb-4 pt-0 d-flex gap-2 justify-content-end">
					<button type="button" class="btn btn-outline-secondary rounded-pill px-4" data-bs-dismiss="modal">
						Annuler
					</button>

					<button type="submit" class="btn btn-danger rounded-pill px-4 text-light" disabled id="submitPasswordBtn">
						Mettre à jour
					</button>
				</div>
			</form>

		</div>
	</div>
</div>


 <script>
		document.addEventListener('DOMContentLoaded', function () {
		
			const newPasswordInput = document.getElementById('newPassword');
			const confirmBlock = document.getElementById('confirmPasswordBlock');
			const submitBtn = document.getElementById('submitPasswordBtn');
			const confirmInput = confirmBlock.querySelector('input');
		
			const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
		
			function checkPasswords() {
				const newPasswordValid = passwordRegex.test(newPasswordInput.value);
				const confirmMatch = confirmInput.value === newPasswordInput.value;
		
				if (newPasswordValid) {
					confirmBlock.classList.remove('d-none');
				} else {
					confirmBlock.classList.add('d-none');
					submitBtn.disabled = true;
					return;
				}
		
				submitBtn.disabled = !confirmMatch;
			}
		
			newPasswordInput.addEventListener('input', checkPasswords);
			confirmInput.addEventListener('input', checkPasswords);
		
		});
		</script>


{% endblock %}

