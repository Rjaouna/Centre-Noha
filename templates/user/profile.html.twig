{% extends 'base.html.twig' %}

{% block title %}Mon Profil
{% endblock %}

{% block body %}

	<div
		class="mt-4">

{# ================= HEADER : PROFIL UTILISATEUR ================= #}
{% embed '_partials/_page_header.html.twig' with {
    icon: 'bi bi-person-circle',
    title: app.user.nom ? app.user.nom ~ ' ' ~ app.user.prenom : 'Profil utilisateur',
    subtitle: 'Modifier vos informations personnelles'
} %}

	{# Actions métier (optionnel) à gauche : rien ici #}
	{% block header_actions_left %}
		{# Exemple si tu veux ajouter un bouton :
		        <a href="{{ path('app_cabinet_index') }}" class="action-icon bg-outline" data-bs-toggle="tooltip" title="Paramètres">
		            <i class="bi bi-gear"></i>
		        </a>
		        #}
	{% endblock %}

	{# Navigation (droite) : on garde le default Home + Retour du partial #}
	{# Si tu veux uniquement Retour (sans Home), décommente ce bloc :
	    {% block header_actions_right %}
	        <a href="javascript:void(0);" onclick="history.back()" class="action-icon bg-light" data-bs-toggle="tooltip" title="Retour">
	            <i class="bi bi-arrow-left"></i>
	        </a>
	    {% endblock %}
	    #}

{% endembed %}


	</div>


	<!-- ⭐⭐ FORMULAIRE ⭐⭐ -->
	<div class="card shadow-lg border-0 rounded-4 p-4">

		<h4 class="fw-bold text-danger mb-4 d-flex align-items-center">
			<i class="bi bi-gear-fill me-2"></i>
			Informations personnelles
		</h4>

		<form method="post">
			<div
				class="row g-4">

				<!-- Prénom -->
				<div class="col-md-6">
					<div class="form-floating mb-3">
						<input type="text" id="prenom" name="prenom" class="form-control shadow-sm rounded-4" placeholder="Votre prénom" value="{{ user.prenom }}" required>
						<label for="prenom">
							<i class="bi bi-person"></i>
							Prénom</label>
					</div>
				</div>

				<!-- Nom -->
				<div class="col-md-6">
					<div class="form-floating mb-3">
						<input type="text" id="nom" name="nom" class="form-control shadow-sm rounded-4" placeholder="Votre nom" value="{{ user.nom }}" required>
						<label for="nom">
							<i class="bi bi-person"></i>
							Nom</label>
					</div>
				</div>

				<!-- Email non modifiable -->
				<div class="col-md-12">
					<div class="form-floating mb-1">
						<input type="email" id="email" class="form-control shadow-sm rounded-4 bg-light" placeholder="Adresse email" value="{{ user.email }}" disabled>
						<label for="email">
							<i class="bi bi-envelope"></i>
							Adresse email</label>
					</div>

					<small class="text-muted fst-italic">
						<i class="bi bi-info-circle"></i>
						Contactez l’administrateur pour modifier votre adresse email.
					</small>
				</div>

			</div>

			<div class="text-end mt-4">
				<button class="btn btn-danger btn-lg rounded-pill px-5 shadow-sm d-flex align-items-center gap-2">
					<i class="bi bi-check-circle"></i>
					Enregistrer
				</button>
			</div>

		</form>

<hr class="my-4">

<div class="d-flex justify-content-end">
	<a href="#" class="text-danger fw-bold d-flex align-items-center gap-2" data-bs-toggle="modal" data-bs-target="#changePasswordModal">
		<i class="bi bi-shield-lock"></i>
		Changer mon mot de passe
	</a>
</div></div><div class="modal fade" id="changePasswordModal" tabindex="-1">
<div class="modal-dialog modal-dialog-centered">
	<div class="modal-content rounded-4">


		<form method="post" action="{{ path('app_change_password') }}">
			<div class="modal-header">
				<h5 class="modal-title text-danger">
					<i class="bi bi-key"></i>
					Changer le mot de passe
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>

			</div>


			<div
				class="modal-body">

				<!-- Mot de passe actuel -->
				<div class="mb-3">
					<label class="form-label">Mot de passe actuel</label>
					<input type="password" name="current_password" class="form-control" required>


				</div>

				<!-- Nouveau mot de passe -->
				<div class="mb-3">
					<label class="form-label">Nouveau mot de passe</label>
					<input type="password" id="newPassword" name="new_password" class="form-control" required>
					<small id="passwordHelp" class="text-muted">
						Minimum 8 caractères, lettres et chiffres
					</small>


</div>


<!-- Confirmation (cachée par défaut) -->
<div class="mb-3 d-none" id="confirmPasswordBlock">
	<label class="form-label">Confirmer le nouveau mot de passe</label>
	<input type="password" name="confirm_password" class="form-control" required>
</div></div><div class="modal-footer">
<button type="submit" class="btn btn-danger" disabled id="submitPasswordBtn">
	Mettre à jour
</button></div></form></div></div></div> <script>
		document.addEventListener('DOMContentLoaded', function () {
		
			const newPasswordInput = document.getElementById('newPassword');
			const confirmBlock = document.getElementById('confirmPasswordBlock');
			const submitBtn = document.getElementById('submitPasswordBtn');
			const confirmInput = confirmBlock.querySelector('input');
		
			const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;
		
			function checkPasswords() {
				const newPasswordValid = passwordRegex.test(newPasswordInput.value);
				const confirmMatch = confirmInput.value === newPasswordInput.value;
		
				if (newPasswordValid) {
					confirmBlock.classList.remove('d-none');
				} else {
					confirmBlock.classList.add('d-none');
					submitBtn.disabled = true;
					return;
				}
		
				submitBtn.disabled = !confirmMatch;
			}
		
			newPasswordInput.addEventListener('input', checkPasswords);
			confirmInput.addEventListener('input', checkPasswords);
		
		});
		</script>


{% endblock %}

