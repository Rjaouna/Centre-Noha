{% extends 'base.html.twig' %}

{% block title %}
	{{ hopital.etablissement }}
	- √âtablissement hospitalier
{% endblock %}

{% block body %}

	<div class="mt-4">

		<!-- ==================================== -->
		<!-- üîµ HEADER UNIFORME STYLE APPLICATION -->
		<!-- ==================================== -->
			<div class="card shadow-lg border-0 rounded-4 mb-4"> <div class="card-body py-4 px-4">

				<div
					class="row align-items-center g-3">

					<!-- Titre + ic√¥ne -->
					<div class="col-md-7 d-flex align-items-center">
						<div class="icon-circle bg-primary bg-opacity-10 text-primary me-3 d-flex justify-content-center align-items-center" style="width:60px; height:60px; border-radius:16px;">
							<i class="bi bi-hospital fs-3"></i>
						</div>

						<div>
							<h2 class="fw-bold text-primary mb-1">{{ hopital.etablissement }}</h2>
							<p class="text-muted mb-0">
								<i class="bi bi-geo-alt-fill me-1"></i>
								Commune :
								<strong>{{ hopital.commune }}</strong>
							</p>
						</div>
					</div>

					<!-- Bouton retour -->
					<div class="col-md-5 d-flex justify-content-md-end">
						<button type="button" onclick="history.back()" class="btn btn-outline-primary btn-lg rounded-pill px-4 shadow-sm d-flex align-items-center gap-2">
							<i class="bi bi-arrow-left"></i>
							Retour
						</button>
					</div>

				</div>
			</div>
		</div>

		<!-- ==================================== -->
		<!-- üü¶ Informations d√©taill√©es            -->
		<!-- ==================================== -->
			<div class="card shadow-lg border-0 rounded-4 mb-4"> <div class="card-body p-4">

				<h4 class="fw-bold text-primary mb-4 d-flex align-items-center">
					<i class="bi bi-info-circle-fill me-2 fs-4"></i>
					Informations d√©taill√©es
				</h4>

				<div
					class="row g-4">

					<!-- R√©gion -->
					<div class="col-md-6">
						<div class="bg-light border rounded-4 p-3 shadow-sm h-100">
							<p class="text-muted small mb-1">
								<i class="bi bi-map me-1"></i>
								R√©gion
							</p>
							<p class="fw-semibold fs-5 mb-0">{{ hopital.region }}</p>
						</div>
					</div>

					<!-- D√©l√©gation -->
					<div class="col-md-6">
						<div class="bg-white border rounded-4 p-3 shadow-sm h-100">
							<p class="text-muted small mb-1">
								<i class="bi bi-building me-1"></i>
								D√©l√©gation
							</p>
							<p class="fw-semibold mb-0">{{ hopital.delegation }}</p>
						</div>
					</div>

					<!-- Commune -->
					<div class="col-md-6">
						<div class="bg-light border rounded-4 p-3 shadow-sm h-100">
							<p class="text-muted small mb-1">
								<i class="bi bi-geo-alt me-1"></i>
								Commune
							</p>
							<p class="fw-semibold mb-0">{{ hopital.commune }}</p>
						</div>
					</div>

					<!-- Type √©tablissement -->
					<div class="col-md-6">
						<div class="bg-white border rounded-4 p-3 shadow-sm h-100">
							<p class="text-muted small mb-1">
								<i class="bi bi-hospital-fill me-1"></i>
								Type d‚Äô√©tablissement
							</p>
							<span class="badge bg-info text-dark px-3 py-2 rounded-pill shadow-sm">
								{{ hopital.categorie }}
							</span>
						</div>
					</div>

				</div>

			</div>
		</div>

		<!-- ==================================== -->
		<!-- üíå LETTRE DE RECOMMANDATION          -->
		<!-- ==================================== -->
			<div class="card shadow-lg border-0 rounded-4"> <div class="card-body p-4">

				<h4 class="fw-bold text-primary mb-4 d-flex align-items-center">
					<i class="bi bi-envelope-paper-heart me-2 fs-4"></i>
					Lettre de recommandation
				</h4>

				<!-- S√©lection patient -->
				<div class="form-floating mb-3">
					<select id="selectPatient" class="form-select rounded-4">
						<option value="">-- S√©lectionner un patient --</option>

						{% for p in patients %}
							<option value="{{ p.id }}">{{ p.nom }}</option>
						{% endfor %}
					</select>
					<label for="selectPatient">Choisir un patient</label>
				</div>

				<!-- Motif -->
				<div class="form-floating mb-3">
					<textarea class="form-control rounded-4" id="motifRecommandation" placeholder="Motif de la recommandation" style="height:120px"></textarea>
					<label for="motifRecommandation">Motif de recommandation</label>
				</div>

				<button id="btnRecommandation" class="btn btn-primary btn-lg rounded-pill px-4 shadow-sm gap-2 d-flex align-items-center">
					<i class="bi bi-pencil-square"></i>
					Cr√©er la lettre
				</button>

				<div id="recAlert" class="mt-3"></div>
			</div>
		</div>

	</div>

	<!-- Script -->
	 <script>
	document.getElementById('btnRecommandation').addEventListener('click', () => {
	
	    const patientId = document.getElementById('selectPatient').value;
	    const hopitalId = "{{ hopital.id }}";
	    const motif = document.getElementById('motifRecommandation').value.trim();
	    const alertBox = document.getElementById('recAlert');
	
	    alertBox.innerHTML = "";
	
	    if (!patientId) {
	        alertBox.innerHTML = `<div class="alert alert-warning rounded-4 mt-2">
	            <i class="bi bi-exclamation-triangle-fill"></i>
	            Veuillez s√©lectionner un patient.
	        </div>`;
	        return;
	    }
	
	    if (!motif) {
	        alertBox.innerHTML = `<div class="alert alert-warning rounded-4 mt-2">
	            <i class="bi bi-exclamation-circle-fill"></i>
	            Veuillez saisir un motif de recommandation.
	        </div>`;
	        return;
	    }
	
	    // Loading
	    alertBox.innerHTML = `
	        <div class="alert alert-info rounded-4 mt-2 d-flex align-items-center">
	            <div class="spinner-border spinner-border-sm text-primary me-2"></div>
	            Pr√©paration de la lettre...
	        </div>
	    `;
	
	    setTimeout(() => {
	        const url = `/recommendation/new?patient=${patientId}&hopital=${hopitalId}&motif=${encodeURIComponent(motif)}`;
	        window.location.href = url;
	    }, 1500);
	
	});
	</script>

{% endblock %}

