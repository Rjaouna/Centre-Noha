{% extends 'base.html.twig' %}

{% block title %}
	{{ hopital.etablissement }}
	- √âtablissement hospitalier
{% endblock %}

{% block body %}

	<div class="mt-4">

		<!-- ============================= -->
		<!-- üîπ HEADER STYLE IDENTIQUE     -->
		<!-- ============================= -->
			<div class="card shadow-lg border-0 rounded-4 mb-4"> <div class="card-body py-4 px-4">

				<div
					class="row align-items-center">

					<!-- Ic√¥ne + titre -->
					<div class="col-12 col-md-7 d-flex align-items-center mb-3 mb-md-0">
						<i class="bi bi-hospital text-primary fs-1 me-3"></i>

						<div>
							<h2 class="fw-bold text-primary mb-1">{{ hopital.etablissement }}</h2>
							<p class="text-secondary m-0">
								Commune :
								<strong>{{ hopital.commune }}</strong>
							</p>
						</div>
					</div>

					<!-- Bouton Retour -->
					<div class="col-12 col-md-5 d-flex justify-content-md-end">
<button type="button" onclick="history.back()" class="btn btn-outline-primary btn-lg rounded-pill px-4 shadow-sm d-flex align-items-center gap-2 w-100 w-md-auto">
	<i class="bi bi-arrow-left"></i>
	Retour

</button>


					</div>

				</div>

			</div>
		</div>


		<!-- ============================= -->
		<!-- üîπ FICHE D√âTAILL√âE H√îPITAL    -->
		<!-- ============================= -->
			<div class="card shadow-lg border-0 rounded-4"> <div class="card-body p-4">

				<h4 class="fw-bold text-primary mb-4 d-flex align-items-center">
					<i class="bi bi-info-circle-fill me-2"></i>
					Informations d√©taill√©es
				</h4>

				<div
					class="row g-4">

					<!-- R√©gion -->
					<div class="col-md-6">
						<div class="info-bloc p-3 border rounded-4 bg-light shadow-sm-sm">
							<span class="text-secondary small d-flex align-items-center mb-1">
								<i class="bi bi-map me-2"></i>
								R√©gion
							</span>
							<p class="fw-bold fs-5 m-0">{{ hopital.region }}</p>
						</div>
					</div>

					<!-- D√©l√©gation -->
					<div class="col-md-6">
						<div class="info-bloc p-3 border rounded-4 shadow-sm-sm">
							<span class="text-secondary small d-flex align-items-center mb-1">
								<i class="bi bi-building me-2"></i>
								D√©l√©gation
							</span>
							<p class="fw-semibold m-0">{{ hopital.delegation }}</p>
						</div>
					</div>

					<!-- Commune -->
					<div class="col-md-6">
						<div class="info-bloc p-3 border rounded-4 bg-light shadow-sm-sm">
							<span class="text-secondary small d-flex align-items-center mb-1">
								<i class="bi bi-geo-alt me-2"></i>
								Commune
							</span>
							<p class="fw-semibold m-0">{{ hopital.commune }}</p>
						</div>
					</div>

					<!-- Type / Cat√©gorie -->
					<div class="col-md-6">
						<div class="info-bloc p-3 border rounded-4 shadow-sm-sm">
							<span class="text-secondary small d-flex align-items-center mb-1">
								<i class="bi bi-hospital-fill me-2"></i>
								Type d‚Äô√©tablissement
							</span>
							<p class="m-0">
								<span class="badge bg-info text-dark px-3 py-2 shadow-sm">
									{{ hopital.categorie }}
								</span>
							</p>
						</div>
					</div>

				</div>

			</div>
		</div>

	</div>
<!-- ‚≠ê SECTION LETTRE DE RECOMMANDATION ‚≠ê -->
<div class="card shadow-lg border-0 rounded-4 mt-4">
	<div class="card-body p-4">

		<h4 class="fw-bold text-primary mb-4 d-flex align-items-center">
			<i class="bi bi-envelope-paper-heart me-2"></i>
			Lettre de recommandation
		</h4>

		<!-- Patients -->
		<div class="form-floating mb-3">
			<select id="selectPatient" class="form-select">
				<option value="">-- S√©lectionner un patient --</option>

				{% for p in patients %}
					<option value="{{ p.id }}">
						{{ p.nom }}
					</option>
				{% endfor %}
			</select>
			<label for="selectPatient">Choisir un patient</label>
		</div>
		<!-- Motif de recommandation -->
		<div class="form-floating mb-3">
			<textarea class="form-control" placeholder="Motif de la recommandation" id="motifRecommandation" style="height: 120px"></textarea>
			<label for="motifRecommandation">Motif de recommandation</label>
		</div>


		<button id="btnRecommandation" class="btn btn-primary btn-lg rounded-pill px-4 shadow-sm">
			<i class="bi bi-pencil-square me-2"></i>
			Cr√©er la lettre
		</button>

		<div id="recAlert" class="mt-3"></div>
	</div>
</div>

 <script>
document.getElementById('btnRecommandation').addEventListener('click', () => {

    const patientId = document.getElementById('selectPatient').value;
    const hopitalId = "{{ hopital.id }}";
    const motif = document.getElementById('motifRecommandation').value.trim();
    const alertBox = document.getElementById('recAlert');

    alertBox.innerHTML = "";

    if (!patientId) {
        alertBox.innerHTML = `
            <div class="alert alert-warning rounded-4 mt-2">
                <i class="bi bi-exclamation-triangle-fill"></i>
                Veuillez s√©lectionner un patient.
            </div>`;
        return;
    }

    if (!motif) {
        alertBox.innerHTML = `
            <div class="alert alert-warning rounded-4 mt-2">
                <i class="bi bi-exclamation-circle-fill"></i>
                Veuillez saisir un motif de recommandation.
            </div>`;
        return;
    }

    alertBox.innerHTML = `
        <div class="alert alert-info rounded-4 mt-2 d-flex align-items-center">
            <div class="spinner-border spinner-border-sm text-primary me-2"></div>
            Pr√©paration de la lettre...
        </div>
    `;

    setTimeout(() => {
        const url = `/recommendation/new?patient=${patientId}&hopital=${hopitalId}&motif=${encodeURIComponent(motif)}`;
        window.location.href = url;
    }, 1500);

});
</script>



{% endblock %}

