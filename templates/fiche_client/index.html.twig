{% extends 'base.html.twig' %}

{% block title %}Liste des Patients
{% endblock %}

{% block body %}
	<div class="container-fluid mt-4">

		{# -------------------------------------------- #}
		{# ðŸ”µ HEADER STYLE FICHE PATIENT                #}
		{# -------------------------------------------- #}
			<div class="card shadow-lg border-0 rounded-4 mb-4"> <div class="card-body d-flex justify-content-between align-items-center py-4 px-4">

				<div class="d-flex align-items-center">
					<i class="bi bi-people-fill text-primary fs-1 me-3"></i>
					<div>
						<h2 class="fw-bold text-primary mb-1">Gestion des Patients</h2>
						<p class="text-muted mb-0">Suivi complet â€” consultations, dossiers et historique mÃ©dical</p>
					</div>
				</div>

				<button id="addClient" class="btn btn-success btn-lg px-4 d-flex align-items-center" data-bs-toggle="modal" data-bs-target="#modalAddClient">
					<i class="bi bi-person-plus fs-4 me-2"></i>
					Nouveau patient
				</button>

			</div>
		</div>

		{# -------------------------------------------- #}
		{# ðŸŸ¦ TABLEAU MODERNE DES PATIENTS              #}
		{# -------------------------------------------- #}

			<table id="patientsTable" class="table table-striped table-hover align-middle rounded-4 overflow-hidden" style="width:100%"> <thead class="table-primary text-dark">
				<tr>
					<th>#</th>
					<th>
						<i class="bi bi-person-fill"></i>
						Nom</th>
					<th>
						<i class="bi bi-geo-alt"></i>
						Ville</th>
					<th>
						<i class="bi bi-telephone"></i>
						TÃ©lÃ©phone</th>
					<th>
						<i class="bi bi-heart-pulse"></i>
						Type maladie</th>
					<th>
						<i class="bi bi-clock"></i>
						CrÃ©Ã©</th>
					<th>
						<i class="bi bi-pencil"></i>
						ModifiÃ©</th>
					<th class="text-center">
						<i class="bi bi-gear"></i>
						Actions</th>
				</tr>
			</thead>

			<tbody>
				{% for fiche_client in fiche_clients %}
					<tr>
						<td class="fw-bold">{{ fiche_client.id }}</td>
						<td class="fw-semibold">{{ fiche_client.nom }}</td>
						<td>{{ fiche_client.ville }}</td>
						<td>{{ fiche_client.telephone }}</td>
						<td>
							<span class="badge bg-info text-dark px-3 py-2 rounded-pill shadow-sm">{{ fiche_client.typeMaladie }}</span>
						</td>
						<td>
							<span class="text-muted">{{ fiche_client.createdAt|date('d/m/Y H:i') }}</span>
						</td>
						<td>
							<span class="text-muted">{{ fiche_client.updatedAt|date('d/m/Y H:i') }}</span>
						</td>
						<td class="text-center">
							<a href="{{ path('app_fiche_client_show', {'id': fiche_client.id}) }}" class="btn btn-outline-primary btn-sm px-3 rounded-pill shadow-sm detailsButton">
								<i class="bi bi-eye"></i>
								Voir
							</a>
						</td>
					</tr>
				{% endfor %}
			</tbody>

		</table>

		{# -------------------------------------------- #}
		{# ðŸŸ¢ MODAL AJOUT PATIENT                        #}
		{# -------------------------------------------- #}
			<div class="modal fade" id="modalAddClient" tabindex="-1"> <div class="modal-dialog modal-xl">
				<div class="modal-content rounded-4 shadow-lg">

					<div class="modal-header bg-primary text-white rounded-top-4">
						<h5 class="modal-title fw-bold d-flex align-items-center">
							<i class="bi bi-person-plus fs-4 me-2"></i>
							Ajouter un patient
						</h5>
						<button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
					</div>

					<div class="modal-body p-4">
						{{ include('fiche_client/_form.html.twig') }}
					</div>

				</div>
			</div>
		</div>

	</div>
{% endblock %}


{# -------------------------------------------- #}
{# ðŸŸ¡ JAVASCRIPTS                                 #}
{# -------------------------------------------- #}
	{% block javascripts %}
{{ parent() }}

	{# jQuery + DataTables #}
	 <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	 <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
	 <script src="https://cdn.datatables.net/responsive/2.4.1/js/dataTables.responsive.min.js"></script> <script>
		        document.addEventListener("DOMContentLoaded", () => {
		
		            // Activation DataTables
		            $('#patientsTable').DataTable({
		                pageLength: 10,
		                language: { url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json" },
		                order: [[0, "desc"]],
		                responsive: true
		            });
		
		            

						// Ajoute un ID unique Ã  chaque bouton Voir
						document.querySelectorAll(".detailsButton").forEach((btn, index) => {
							btn.id = "detailsButton-" + index;    // --> detailsButton-0, detailsButton-1, etc.
							buttonSoundClick(btn.id);
						});
					
		
		        });
		    </script>

{% endblock %}

