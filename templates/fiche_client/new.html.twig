
		<div data-turbo="false">
			{{ include('fiche_client/_form.html.twig') }}
		</div>


	 <script>
	document.addEventListener("DOMContentLoaded", () => {
	
	    const form = document.getElementById("ficheForm");
	
	    form.addEventListener("submit", async function (e) {
	        e.preventDefault();
	
	        const formData = new FormData(form);
	
	        // üî• Transforme "fiche_client[nom]" ‚Üí "nom"
	        let data = {};
	        formData.forEach((value, key) => {
	            const cleanKey = key.replace('fiche_client[', '').replace(']', '');
	            data[cleanKey] = value;
	        });
	
	        try {
	            const response = await fetch("{{ path('app_fiche_client_new') }}", {
	                method: "POST",
	                headers: {
	                    "Content-Type": "application/json",
	                    "X-Requested-With": "XMLHttpRequest"
	                },
	                body: JSON.stringify(data)
	            });
	
	            // Si Symfony renvoie une erreur HTML ‚Üí emp√™cher JSON.parse()
	            const text = await response.text();
	
	            if (!response.ok) {
	                console.error("R√©ponse serveur :", text);
	                alert("Erreur d√©tect√©e : voir console.");
	                return;
	            }
	
	            const result = JSON.parse(text);
	            console.log(result);
	
	            alert("Fiche cr√©√©e (ID : " + result.id + ")");
	            form.reset();
	
	        } catch (error) {
	            console.error("Erreur JS :", error);
	            alert("Erreur JS d√©tect√©e, voir console.");
	        }
	    });
	});
	</script>



