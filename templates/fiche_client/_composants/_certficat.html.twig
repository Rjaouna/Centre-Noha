<div class="modal fade" id="certificatPrintModal" tabindex="-1">
	<div class="modal-dialog modal-lg modal-dialog-centered">
		<div class="modal-content">

			<div class="modal-header">
				<h5 class="modal-title">
					Choisir un certificat médical
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>

			<div class="modal-body">
				<div id="certificat-modal-body" class="text-center py-4">
					<div class="spinner-border text-primary"></div>
					<p class="mt-2 text-secondary">Chargement des certificats…</p>
				</div>
			</div>

		</div>
	</div>
</div>
 <script>
let certificatModal;

document.addEventListener('DOMContentLoaded', () => {
    certificatModal = new bootstrap.Modal(
        document.getElementById('certificatPrintModal')
    );
});

function openCertificatModal(patientId) {
    certificatModal.show();

fetch('/certificats/certificats/ajax/list')

        .then(res => res.json())
        .then(data => renderCertificatList(data, patientId))
        .catch(() => {
            document.getElementById('certificat-modal-body').innerHTML =
                `<div class="alert alert-danger">Erreur de chargement</div>`;
        });
}

function renderCertificatList(certificats, patientId) {

    if (certificats.length === 0) {
        document.getElementById('certificat-modal-body').innerHTML = `
            <div class="alert alert-warning text-center">
                Aucun certificat disponible.
            </div>`;
        return;
    }

    let html = '<div class="list-group">';

    certificats.forEach(cert => {
        html += `
            <button
                class="list-group-item list-group-item-action d-flex justify-content-between align-items-center"
                onclick="printCertificat(${patientId}, ${cert.id})">
                <span>
                    <i class="bi bi-file-medical text-primary me-2"></i>
                    ${cert.titre}
                </span>
                <i class="bi bi-printer text-secondary"></i>
            </button>
        `;
    });

    html += '</div>';

    document.getElementById('certificat-modal-body').innerHTML = html;
}

function printCertificat(patientId, certificatId) {
    const url = `/certificats/print/patient/${patientId}/${certificatId}`;
    window.open(url, '_blank');
}
</script>


