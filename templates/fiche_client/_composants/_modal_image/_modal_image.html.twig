<div class="modal fade" id="modalUploadImage" tabindex="-1">
	<div class="modal-dialog">
		<div class="modal-content">

			<div class="modal-header bg-primary text-white">
				<h5 class="modal-title">Ajouter une image</h5>
				<button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
			</div>

			<div class="modal-body">

				<form id="imageUploadForm" enctype="multipart/form-data">
					<input type="file" name="image[imageFile]" class="form-control mb-3" accept="image/*" required>

					<button type="submit" class="btn btn-success w-100 rounded-pill">
						<i class="bi bi-upload"></i>
						Upload
					</button>
				</form>

				<div id="uploadResult" class="mt-3"></div>

			</div>

		</div>
	</div>
</div>


 <script>
document.getElementById('imageUploadForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form    = this;
    const formData = new FormData(form);
    const resultBox = document.getElementById("uploadResult");
    const pop = document.getElementById("popupSuccess");

    resultBox.innerHTML = "";

    const url = "{{ path('app_image_upload', { id: fiche_client.id }) }}";

    let response = await fetch(url, {
        method: "POST",
        body: formData
    });

    let data;
    try {
        data = await response.json();
    } catch (error) {
        resultBox.innerHTML = `
            <div class="alert alert-danger rounded-4">Erreur interne.</div>
        `;
        return;
    }

    if (data.status === "success") {

        // ðŸŸ¢ Popup succÃ¨s
        pop.style.display = "block";
        buttonSoundSuccess('imageUploadForm');

        pop.innerHTML = `
<div class="d-flex align-items-start">
	<i class="bi bi-check-circle-fill fs-1 text-white bg-success p-2 rounded-circle me-3"></i>
	<div>
		<h5 class="fw-bold mb-1 text-light">Image ajoutÃ©e avec succÃ¨s ðŸŽ‰</h5>
		<p class="text-light mb-1">Votre image a Ã©tÃ© enregistrÃ©e.</p>
	</div>
	<button type="button" class="btn-close" onclick="document.getElementById('popupSuccess').style.display='none';"></button>
</div>
        `;

        // ðŸ”’ Fermer la modal automatiquement
        const modal = bootstrap.Modal.getInstance(document.getElementById('modalUploadImage'));
        modal.hide();

        // ðŸ”„ Reset du formulaire
        form.reset();

        // ðŸŽ¨ Ajouter l'image dans la galerie sans recharger
        if (data.fileName) {
            const gallery = document.getElementById("gallery");

            if (gallery) {
                gallery.insertAdjacentHTML("afterbegin", `
                    <div class="gallery-item position-relative col-2">
                        <img src="/uploads/clients/${data.fileName}"
                             alt="Image du patient"
                             class="img-fluid rounded shadow-sm gallery-thumb new-image"
                             data-bs-toggle="modal"
                             data-bs-target="#modalGalleryView"
                             data-image="${data.fileName}">
                    </div>
                `);
            }
        }

        // âœ¨ Animation dâ€™apparition
        setTimeout(() => {
            document.querySelector(".new-image")?.classList.remove("new-image");
        }, 50);

    } else {
        resultBox.innerHTML = `
            <div class="alert alert-danger rounded-4">${data.message}</div>
        `;
    }
});
</script>






