{% extends 'base.html.twig' %}

{% block title %}Recherche des M√©dicaments
{% endblock %}

{% block body %}

	<div
		class="mt-4">

		<!-- ‚≠ê‚≠ê ENT√äTE STYLE PATIENTS ‚≠ê‚≠ê -->
		<div class="card shadow-lg border-0 rounded-4 mb-4">
			<div class="card-body py-4 px-4">

				<div class="row align-items-center">

					<div class="col-12 col-md-7 d-flex align-items-center mb-3 mb-md-0">
<i class="bi bi-capsule-pill text-danger fs-1 me-3"></i>

						<div>
<h2 class="fw-bold text-danger mb-1">Recherche des M√©dicaments</h2>

							<p class="text-secondary m-0">Tapez pour rechercher un m√©dicament</p>
						</div>
					</div>

<!-- üîô Boutons actions -->
<div class="col-12 col-md-5 d-flex justify-content-md-end">

<div class="d-flex gap-2 w-100 w-md-auto">

	<button type="button" onclick="history.back()" class="btn btn-outline-primary btn-lg rounded-pill px-4 shadow-sm d-flex align-items-center justify-content-center gap-2 w-100 w-md-auto">
		<i class="bi bi-arrow-left"></i>
		Retour

</button>


<a href="{{ path('medicine_new') }}" class="btn btn-danger btn-lg rounded-pill px-4 shadow-sm d-flex align-items-center justify-content-center gap-2 w-100 w-md-auto">
	<i class="bi bi-plus-circle"></i>
	Ajouter un m√©dicament
</a>


</div>

</div>



				</div>

			</div>
		</div>

	</div>

	<!-- ‚≠ê‚≠ê CHAMP DE RECHERCHE ‚≠ê‚≠ê -->
	<div class="position-relative my-4">
		<i class="bi bi-search text-secondary position-absolute top-50 start-3 translate-middle-y"></i>

		<input type="text" id="medicineSearch" class="form-control-lg shadow-sm form-control rounded-pill ps-5" placeholder="Rechercher un m√©dicament...">
	</div>

	<style>
		.start-3 {
			left: 16px;
		}
	</style>

	<!-- ‚≠ê‚≠ê CONTENU STATIQUE D‚ÄôINTRO ‚≠ê‚≠ê -->
	<div id="staticIntro" class="mb-4">

		

		<div class="row g-4">

			<div class="col-md-4">
				<div class="card med-info shadow-sm border-0 rounded-4 p-4 h-100">
					<i class="bi bi-capsule text-danger fs-2 mb-3"></i>
					<h5 class="fw-bold">Vue d‚Äôensemble rapide</h5>
					<p class="text-secondary small">
						Acc√©dez en un coup d‚Äô≈ìil aux m√©dicaments les plus courants de votre pratique
						                    et aux informations essentielles qui les concernent.
					</p>
				</div>
			</div>

			<div class="col-md-4">
				<div class="card med-info shadow-sm border-0 rounded-4 p-4 h-100">
<i class="bi bi-search text-danger fs-2 mb-3"></i>

					<h5 class="fw-bold">Recherche intelligente</h5>
					<p class="text-secondary small">
						Tapez quelques lettres du nom, de la DCI ou du code pour filtrer instantan√©ment
						                    les m√©dicaments de votre base.
					</p>
				</div>
			</div>

			<div class="col-md-4">
				<div class="card med-info shadow-sm border-0 rounded-4 p-4 h-100">
<i class="bi bi-shield-check text-danger fs-2 mb-3"></i>

					<h5 class="fw-bold">Suivi s√©curis√©</h5>
					<p class="text-secondary small">
						Chaque fiche m√©dicament est li√©e √† votre syst√®me de suivi, pour une prise de d√©cision plus simple
						                    et plus s√©curis√©e.
					</p>
				</div>
			</div>

		</div>

	</div>

	<!-- ‚≠ê‚≠ê ZONE DES R√âSULTATS API ‚≠ê‚≠ê -->
	<div id="results"></div>

	<style>
		.med-card {
			background: white;
			border-radius: 20px;
			padding: 22px;
			margin-bottom: 18px;
			border: 1px solid rgba(0, 0, 0, 0.08);
			transition: 0.3s ease;
			cursor: pointer;
		}
		.med-card:hover {
			transform: translateY(-6px);
			box-shadow: 0 18px 40px rgba(0, 0, 0, 0.12);
		}

		.med-info {
			transition: 0.3s ease;
		}
		.med-info:hover {
			transform: translateY(-5px);
			box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
		}
	</style>

	 <script>
	document.addEventListener("DOMContentLoaded", () => {
	
	    const input       = document.getElementById("medicineSearch");
	    const results     = document.getElementById("results");
	    const staticIntro = document.getElementById("staticIntro");
	    let timer         = null;
	
	    function renderResults(data) {
	        results.innerHTML = "";
	
	        data.forEach(m => {
	            const card = `
	                <div class="med-card shadow-sm" onclick="window.location='/medicine/${m.id}'">
	                    <div class="d-flex justify-content-between">
	
	                        <div>
<p class="fw-bold text-secondary mb-1">${m.name} - ${m.dosage} ${m.uniteDosage} ${
		                                m.isGeneric
		                                    ? `<span class="fw-light badge bg-success py-1 mx-1">G√©n√©rique</span>`
		                                    : `<span class="fw-light badge bg-warning py-1 mx-1">Princeps</span>`
		                            }


</p>



	                            <p class="text-secondary small mb-1">
${m.forme} - ${m.presentation}


<span class="text-${m.tauxRembourssement != 0 ? 'success' : 'danger'}">
	${m.tauxRembourssement != 0 ? '(Taux de rembourssement : 70%)' : '(Non Rembourssable)'}</span>


	                            </p>
	                        </div>
	
	                        <div class="text-end">
	                            <span class="badge bg-info text-dark px-3 py-2">${m.ppv} DH</span><br>
	                            
	                        </div>
	
	                    </div>
	                </div>
	            `;
	            results.insertAdjacentHTML("beforeend", card);
	        });
	    }
	
	    input.addEventListener("keyup", () => {
	
	        clearTimeout(timer);
	
	        timer = setTimeout(() => {
	
	            const q = input.value.trim();
	
	            // Si moins de 2 caract√®res ‚Üí on remet l'intro et on vide les r√©sultats
	            if (q.length < 2) {
	                staticIntro.style.display = "block";
	                results.innerHTML = "";
	                return;
	            }
	
	            // D√®s qu'on commence une vraie recherche ‚Üí cacher l'intro
	            staticIntro.style.display = "none";
	
	            fetch(`/medicine/search/api?search=${encodeURIComponent(q)}`)
	                .then(res => res.json())
	                .then(data => {
	
	                    if (data.length === 0) {
	                        results.innerHTML = `
	                            <div class="alert alert-warning text-center rounded-4 py-3">
	                                Aucun m√©dicament trouv√©.
	                            </div>`;
	                        return;
	                    }
	
	                    renderResults(data);
	                });
	
	        }, 250);
	    });
	
	});
	</script>

{% endblock %}

