
{% include 'home/_modals/_salle.html.twig' %}



<div data-bs-toggle="modal" data-bs-target="#waitingRoomModal" id="openWaitingRoomDesktop" class="position-fixed footer-toggle" style="bottom: 70px; right: 20px;z-index:3000">


<i class="bi-people-fill"></i>






</div>

<footer id="main-footer" class="footer-thin d-none">

	<div class="container py-4">

		<div
			class="row gy-4">

			<!-- Bloc 1 -->
			<div class="col-12 col-sm-6 col-md-3">
				<div class="footer-card">
					
					<p class="footer-text">
<i class="bi bi-c-circle text-muted me-1"></i>
2025 ‚Äî




<a href="#">We Digit All</a>
| Design :
<a href="#">Oudades Studio
</a>
					</p>
				</div>
			</div>

			<!-- Bloc 2 -->
			<div class="col-12 col-sm-6 col-md-3">
				<div class="footer-card">
					<h6 class="footer-title">
						<i class="bi bi-info-circle-fill me-1"></i>
						Aide
					</h6>
					<a href="{{ path('app_how_it_works') }}" class="footer-link d-block">Manuel d‚Äôutilisation</a>
				</div>
			</div>

			<!-- Bloc 3 -->
			<div class="col-12 col-sm-6 col-md-3">
				<div class="footer-card">
					<h6 class="footer-title">
						<i class="bi bi-headset me-1"></i>
						Support
					</h6>
					<p class="footer-text mb-1 text-primary fw-bold">
+33 6 59 22 10 04
<span class="footer-subtext">Disponible 7j/7</span>

					</p>
					
				</div>
			</div>

			<!-- Bloc 4 -->
			<div class="col-12 col-sm-6 col-md-3">
				<div class="footer-card">
					<h6 class="footer-title">
						<i class="bi bi-envelope-fill me-1"></i>
						Contact
					</h6>
					<a href="mailto:contact@wedigitall.com" class="footer-link d-block">
						contact@wedigitall.com
					</a>
				</div>
			</div>

		</div>
	</div>

</footer>

 <script>
(() => {
  const API_URL = '/api/caisse/recette-du-jour';
  const MODAL_ID = 'waitingRoomModal';
  const REFRESH_MS = 30000;

  let timer = null;

  const elDesktop = () => document.getElementById('wrTodayRevenue');
  const elMobile  = () => document.getElementById('wrTodayRevenueMobile');

  const setRevenue = (value) => {
    const v = Number(String(value ?? '0').replace(',', '.'));
    const txt = (Number.isFinite(v) ? v : 0).toFixed(2).replace('.', ',');
    if (elDesktop()) elDesktop().textContent = txt;
    if (elMobile())  elMobile().textContent  = txt;
  };

  const setLoading = () => {
    if (elDesktop()) elDesktop().textContent = '‚Ä¶';
    if (elMobile())  elMobile().textContent  = '‚Ä¶';
  };

  const setError = () => {
    if (elDesktop()) elDesktop().textContent = '‚Äî';
    if (elMobile())  elMobile().textContent  = '‚Äî';
  };

  async function fetchTodayRevenue() {
    const token = localStorage.getItem('jwt_token');

    const res = await fetch(API_URL, {
      method: 'GET',
      headers: {
        'Accept': 'application/json',
        ...(token ? { 'Authorization': 'Bearer ' + token } : {})
      },
      credentials: 'same-origin'
    });

    const raw = await res.text();

    console.log('üì¶ [CAISSE] status:', res.status);
    console.log('üì¶ [CAISSE] raw response:', raw);

    let data;
    try { data = JSON.parse(raw); }
    catch {
      // Souvent ici: page HTML (login/redirect) -> donc pas JSON
      throw new Error('R√©ponse non JSON (probable redirect/login/HTML).');
    }

    if (!res.ok) {
      throw new Error(data?.message || ('HTTP ' + res.status));
    }

    if (!data.success) {
      throw new Error(data?.message || 'success=false');
    }

    return data.total; // "123.45"
  }

  async function refresh() {
    // si les spans ne sont pas dans le DOM, inutile d'appeler l'API
    if (!elDesktop() && !elMobile()) {
      console.warn('‚ö†Ô∏è [CAISSE] spans wrTodayRevenue introuvables dans le DOM');
      return;
    }

    setLoading();

    try {
      const total = await fetchTodayRevenue();
      setRevenue(total);
      console.log('‚úÖ [CAISSE] total affich√©:', total);
    } catch (e) {
      console.error('‚ùå [CAISSE] erreur:', e);
      setError();
    }
  }

  function start() {
    if (timer) return;
    console.log('‚ñ∂Ô∏è [CAISSE] start refresh');
    refresh();
    timer = setInterval(refresh, REFRESH_MS);
  }

  function stop() {
    if (!timer) return;
    console.log('‚èπÔ∏è [CAISSE] stop refresh');
    clearInterval(timer);
    timer = null;
  }

  // 1) Quand le modal s‚Äôouvre => refresh + interval
  document.addEventListener('shown.bs.modal', (e) => {
    if (e.target?.id === MODAL_ID) start();
  });

  // 2) Quand il se ferme => stop interval
  document.addEventListener('hidden.bs.modal', (e) => {
    if (e.target?.id === MODAL_ID) stop();
  });

  // 3) Fallback : si la page charge et que les spans existent d√©j√†
  window.addEventListener('load', () => {
    if (elDesktop() || elMobile()) refresh();
  });

  console.log('‚úÖ [CAISSE] script charg√©');
})();
</script>



<style>
/* ===== Footer Container ===== */
/* Animation ouverture / fermeture */
#main-footer {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.35s ease, transform 0.35s ease;
}

#main-footer.show {
    opacity: 1;
    transform: translateY(0);
}

.footer-thin {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    backdrop-filter: blur(12px);
    background: rgba(255, 255, 255, 0.75);
    border-top: 1px solid rgba(0,0,0,0.1);
    z-index: 2000;
    box-shadow: 0 -4px 18px rgba(0,0,0,0.12);
}

/* ===== Cards ===== */
.footer-card {
    padding: 16px;
    border-radius: 0.75rem;
    background: rgba(255, 255, 255, 0.9);
    border: 1px solid rgba(0, 0, 0, 0.06);
    backdrop-filter: blur(8px);
    transition: 0.25s ease;
    box-shadow: 0 2px 10px rgba(0,0,0,0.08);
}

.footer-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 4px 16px rgba(0,0,0,0.12);
}

/* Titles */
.footer-title {
    font-weight: bold;
    font-size: 0.95rem;
    color: var(--bs-primary);
    margin-bottom: 8px;
}

/* Text */
.footer-text {
    font-size: 0.8rem;
    color: #6c757d;
}

.footer-subtext {
    font-size: 0.75rem;
    color: #999;
}

/* Links */
.footer-link {
    font-size: 0.8rem;
    color: #6c757d;
    text-decoration: none;
    transition: 0.25s;
}

.footer-link:hover {
    color: var(--bs-primary);
    margin-left: 6px;
}

/* ===== Toggle Button ===== */
.footer-toggle i {
    width: 40px;
    height: 40px;
    font-size: 1.3rem;

border-radius: 50%;

color: #ff4d4f;


    display: flex;
    justify-content: center;
align-items: center;

box-shadow: 0 4px 12px rgba(0,0,0,0.18);


    transition: 0.3s ease;
    cursor: pointer;
}

.footer-toggle i:hover {
    transform: scale(1.1);
}

/* Rotate animation */
.rotate-180 {
    transform: rotate(180deg);
}

/* ===== Mobile Alignment ===== */
@media (max-width: 768px) {
    .footer-card {
        text-align: left !important;
    }
}
</style>

 <script>
(() => {
  const footer = document.getElementById('main-footer');
  const btn = document.getElementById('footer-toggle-btn'); // <- il faut qu'il existe sinon on sort
  if (!footer || !btn) return;

  const icon = btn.querySelector('i');

  btn.addEventListener('click', () => {
    footer.classList.toggle('d-none');
    setTimeout(() => footer.classList.toggle('show'), 10);
    icon?.classList.toggle('rotate-180');
  });
})();
</script>

 <script>
(() => {
  if (window.__WR_CAISSE_BOUND__) return;
  window.__WR_CAISSE_BOUND__ = true;

  const API_REVENUE   = "/api/caisse/recette-du-jour";
  const API_CLOSE_DAY = "/api/caisse/cloturer-journee";
  const MODAL_ID      = "waitingRoomModal";
  const REFRESH_MS    = 30000;

  const elD = () => document.getElementById("wrTodayRevenue");
  const elM = () => document.getElementById("wrTodayRevenueMobile");

  const setTxt = (t) => {
    if (elD()) elD().textContent = t;
    if (elM()) elM().textContent = t;
  };

  const formatMoney = (v) => {
    const n = Number(String(v ?? "0").replace(",", "."));
    return (Number.isFinite(n) ? n : 0).toFixed(2).replace(".", ",");
  };

  async function fetchJson(url, options = {}) {
    const token = localStorage.getItem("jwt_token");
    const res = await fetch(url, {
      credentials: "same-origin",
      headers: {
        "Accept": "application/json",
        ...(options.headers || {}),
        ...(token ? { "Authorization": "Bearer " + token } : {})
      },
      ...options
    });

    const raw = await res.text();
    let data = null;
    try { data = JSON.parse(raw); } catch { /* HTML/login */ }

    console.log("üì¶ [API]", url, "status=", res.status, "raw=", raw);

    if (!res.ok) throw new Error(data?.message || ("HTTP " + res.status));
    if (!data?.success) throw new Error(data?.message || "success=false");
    return data;
  }

  async function refreshRevenue() {
    if (!elD() && !elM()) return; // spans pas dans le DOM
    setTxt("‚Ä¶");
    try {
      const data = await fetchJson(API_REVENUE, { method: "GET" });
      setTxt(formatMoney(data.total));
    } catch (e) {
      console.error("‚ùå [CAISSE]", e);
      setTxt("‚Äî");
    }
  }

  // Start/Stop refresh quand le modal s'ouvre/ferme
  let timer = null;
  document.addEventListener("shown.bs.modal", (e) => {
    if (e.target?.id !== MODAL_ID) return;
    refreshRevenue();
    timer = setInterval(refreshRevenue, REFRESH_MS);
  });

  document.addEventListener("hidden.bs.modal", (e) => {
    if (e.target?.id !== MODAL_ID) return;
    if (timer) clearInterval(timer);
    timer = null;
  });

  // ‚úÖ Click cl√¥turer (desktop + mobile)
  document.addEventListener("click", async (e) => {
    const btn = e.target.closest("#wrCloseDayBtn, #wrCloseDayBtnMobile");
    if (!btn) return;

    const ok = confirm(
      "√ätes-vous s√ªr de vouloir cl√¥turer la journ√©e ?\n\n" +
      "‚Ä¢ La salle d‚Äôattente sera vid√©e\n" +
      "‚Ä¢ Les prestations du jour seront supprim√©es"
    );
    if (!ok) return;

    const old = btn.innerHTML;
    btn.disabled = true;
    btn.innerHTML = `<span class="spinner-border spinner-border-sm me-2"></span>Cl√¥ture‚Ä¶`;

    try {
      await fetchJson(API_CLOSE_DAY, { method: "POST", headers: { "Content-Type": "application/json" }, body: "{}" });

      alert("Journ√©e cl√¥tur√©e ‚úÖ");
      setTxt("0,00");

      // Optionnel: si tu veux vider visuellement le board
      document.getElementById("wrBoard")?.replaceChildren();

    } catch (err) {
      console.error("‚ùå [CLOTURE]", err);
      alert(err.message || "Erreur cl√¥ture");
    } finally {
      btn.disabled = false;
      btn.innerHTML = old;
    }
  });

  console.log("‚úÖ [WR_CAISSE] script charg√©");
})();
</script>





