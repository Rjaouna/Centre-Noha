{% extends 'base.html.twig' %}

{% block title %}Suivi des soins
{% endblock %}

{% block body %}
<div
	class="card-body d-flex justify-content-between align-items-center py-4 px-4">

	<!-- GAUCHE : Titre -->
	<div class="d-flex align-items-center">
		<i class="bi bi-heart-pulse-fill text-danger fs-1 me-3"></i>
		<div>
			<h2 class="fw-bold text-danger mb-1">Suivi des soins</h2>
			<p class="text-muted mb-0">Historique des soins effectués</p>
		</div>
	</div>

	<!-- DROITE : Boutons -->
	<div class="d-flex gap-3">

		<a href="{{ path('app_suivi_soin_new', {'id': patient.id}) }}" class="btn btn-success btn-lg px-4 rounded-pill shadow-sm d-flex align-items-center">
			<i class="bi bi-journal-plus fs-5 me-2"></i>
			Nouveau soin
		</a>

<a id="returnButtonShow" href="{{ path('app_fiche_client_show', {'id': patient.id}) }}" class="btn btn-secondary btn-lg rounded-pill px-4 shadow-sm d-flex align-items-center gap-2">




			<i class="bi bi-arrow-left"></i>
			Retour
		</a>

	</div>

</div>



		<!-- TABLEAU -->
		<div class="card shadow-sm border-0 rounded-4">
			<div class="card-body p-4">

				<table id="suiviTable" class="table table-striped table-hover align-middle rounded-4 overflow-hidden" style="width:100%;">
					<thead class="table-primary text-dark">
						<tr>

							<th>
								<i class="bi bi-person-fill"></i>
								Nom du patient
							</th>

							<th>
								<i class="bi bi-clipboard-heart"></i>
								Motif du soin / Diagnostic
							</th>

							<th>
								<i class="bi bi-calendar-event"></i>
								Date du soin
							</th>

							<th>
								<i class="bi bi-clock-history"></i>
								Dernière mise à jour
							</th>

							<th class="text-center">
								<i class="bi bi-gear"></i>
								Actions
							</th>

						</tr>
					</thead>

					<tbody>
						{% for suivi_soin in suivi_soins %}
							<tr>

								<!-- NOM PATIENT -->
								<td class="fw-semibold">
									<i class="bi bi-person-circle text-primary me-1"></i>
									{{ suivi_soin.patient ? suivi_soin.patient.nom : '—' }}
								</td>

								<!-- DIAGNOSTIC -->
								<td>{{ suivi_soin.diagnostic }}</td>

								<!-- DATE DU SOIN -->
								<td>
									{{ suivi_soin.createdAt ? suivi_soin.createdAt|date('d/m/Y H:i') : '' }}
								</td>

								<!-- DERNIÈRE MISE À JOUR -->
								<td>
									{{ suivi_soin.updatedAt ? suivi_soin.updatedAt|date('d/m/Y H:i') : '' }}
								</td>

								<!-- ACTIONS -->
								<td class="text-center">
									<a href="{{ path('app_suivi_soin_show', {'id': suivi_soin.id}) }}" class="btn btn-outline-primary btn-sm px-3 rounded-pill me-2">
										<i class="bi bi-eye"></i>
										
									</a>

									<a href="{{ path('app_suivi_soin_edit', {'id': suivi_soin.id}) }}" class="btn btn-outline-warning btn-sm px-3 rounded-pill">
										<i class="bi bi-pencil-square"></i>
										
									</a>
								</td>

							</tr>
						{% else %}
							<tr>
								<td colspan="5" class="text-center text-muted py-4">
									<i class="bi bi-exclamation-circle me-2"></i>
									Aucun suivi trouvé
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>

			</div>
		</div>


	<!-- DATATABLES FIX -->
	 <script>
	document.addEventListener("DOMContentLoaded", () => {
	
	    if (!$.fn.DataTable.isDataTable('#suiviTable')) {
	
	        $('#suiviTable').DataTable({
	            language: {
	                url: "//cdn.datatables.net/plug-ins/1.13.6/i18n/fr-FR.json"
	            },
	            pageLength: 10,
	            order: [[2, "desc"]], // tri par date soin
	            responsive: true
				columnDefs: [
    { defaultContent: "-", targets: "_all" }
]
	        });
	    }
	
	});
	</script>

{% endblock %}

