{% extends 'base.html.twig' %}

{% block title %}Accueil
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
{% endblock %}


{% block body %}

	<div class="container py-4">

		{# ======================= #}
		{# ðŸ”¹ HEADER DASHBOARD #}
		{# ======================= #}
			<div class="card border-0 shadow-sm rounded-4 mb-4"> <div class="card-body py-4 px-4 d-flex justify-content-between align-items-center">

				<div class="d-flex align-items-center">
					<div class="icon-circle bg-primary bg-opacity-10 text-primary
						                            d-flex align-items-center justify-content-center me-3" style="width:60px;height:60px;border-radius:16px;">
						<i class="bi bi-clipboard-pulse fs-3"></i>
					</div>

					<div>
						<h4 class="fw-bold mb-1">Tableau de bord</h4>
						<p class="text-muted mb-0">
							Cabinet
							<span class="fw-semibold text-primary" id="nameCabinet"></span>
						</p>
					</div>
				</div>

				<div class="d-none d-md-flex align-items-center text-muted">
					<i class="bi bi-calendar-event me-2"></i>
					{{ "now"|date("d F Y") }}
				</div>

			</div>
		</div>

		{# ======================= #}
		{# ðŸ”¹ DASHBOARD MOBILE #}
		{# ======================= #}
			<div class="swiper dashboardCoverflow d-md-none"> <div class="swiper-wrapper">

				{% include 'home/_dashboard/_card_mobile.html.twig' with {
                icon: 'bi-person-plus-fill',
                title: 'Ajouter un patient',
                subtitle: 'Nouvelle fiche mÃ©dicale',
                bg: 'bg-add',
                modal: '#modalAddClient'
            } %}

				{% include 'home/_dashboard/_card_mobile.html.twig' with {
                icon: 'bi-people-fill',
                title: 'Patients',
                subtitle: 'Dossiers & historique',
                bg: 'bg-patients',
                link: path('app_fiche_client_index'),
                badge: totalClients ?? null
            } %}

				{% include 'home/_dashboard/_card_mobile.html.twig' with {
                icon: 'bi-capsule-pill',
                title: 'MÃ©dicaments',
                subtitle: 'Prescriptions',
                bg: 'bg-medicines',
                link: path('medicine_index')
            } %}
                {% include 'home/_dashboard/_card_mobile.html.twig' with {
                icon: 'bi-calendar-week',
                title: 'Rendez-vous',
                subtitle: 'Planning & agenda',
                bg: 'bg-rdv',
                link: path('app_rdv_index'),
                badge: totalRdv ?? null
            } %}

			</div>
		</div>

		{# ======================= #}
		{# ðŸ”¹ DASHBOARD DESKTOP #}
		{# ======================= #}
			<div class="row g-3 d-none d-md-flex"> {% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Ajouter un patient',
            desc: 'CrÃ©er une nouvelle fiche',
            icon: 'bi-person-plus-fill',
            bg: 'bg-add',
            modal: '#modalAddClient'
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Patients',
            desc: 'GÃ©rer les dossiers',
            icon: 'bi-people-fill',
            bg: 'bg-patients',
            link: path('app_fiche_client_index'),
            badge: totalClients ?? null
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'MÃ©dicaments',
            desc: 'RÃ©fÃ©rentiel',
            icon: 'bi-capsule-pill',
            bg: 'bg-medicines',
            link: path('medicine_index')
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Rendez-vous',
            desc: 'Planning',
            icon: 'bi-calendar-week',
            bg: 'bg-rdv',
            link: path('app_rdv_index'),
            badge: totalRdv ?? null
        } %}

		</div>

		{# ======================= #}
		{# ðŸ”¹ RESSOURCES #}
		{# ======================= #}
			<div class="mt-5"> <h4 class="fw-bold mb-4">
				<i class="bi bi-ui-checks-grid text-primary me-2"></i>
				RÃ©fÃ©rentiels & Ressources
			</h4>

			<div class="row g-3">
				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-activity',
                color: 'text-warning',
                title: 'SymptÃ´mes',
                subtitle: 'RÃ©fÃ©rentiel clinique',
                link: path('symptome_index')
            } %}

				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-hospital',
                color: 'text-primary',
                title: 'Ã‰tablissements hospitaliers',
                subtitle: 'Recherche & consultation',
                link: path('hopital_search_page')
            } %}

				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-capsule-pill',
                color: 'text-danger',
                title: 'MÃ©dicaments',
                subtitle: 'CNOPS â€“ ANAM',
                link: path('medicine_index')
            } %}
            {% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-heart-pulse',
                color: 'text-success',
                title: 'Dispositifs Remboursables',
                subtitle: 'CNOPS â€“ ANAM',
                link: path('dispositif_search')
            } %}



			</div>
		</div>

		{{ include('home/_stats/_stats.html.twig') }}

	</div>

	{% include 'home/_modals/_add_patient.html.twig' %}

{% endblock %}



{% block javascripts %}
	{{ parent() }}
 <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

	 <script>
	        document.addEventListener('DOMContentLoaded', () => {
	            const el = document.querySelector('.dashboardCoverflow');
	
	            // si on est sur desktop, le slider n'existe pas (d-none d-md-none), donc on skip
	            if (!el || typeof Swiper === "undefined") return;
	
	            new Swiper(el, {
	                effect: 'coverflow',
	                grabCursor: true,
	                centeredSlides: true,
	                slidesPerView: 'auto',
	                spaceBetween: -20,
	                coverflowEffect: {
	                    rotate: 0,
	                    stretch: 0,
	                    depth: 120,
	                    modifier: 1.4,
	                    slideShadows: false,
	                },
	            });
	        });
	    </script>

	 <script>
	        async function afficherNomCabinet() {
	            const res = await fetch("{{ path('app_nom_cabinet') }}");
	            const data = await res.json();
	            const el = document.getElementById('nameCabinet');
	            if (el) el.innerText = data.nom ?? '';
	        }
	        afficherNomCabinet();
	    </script>
{% endblock %}

