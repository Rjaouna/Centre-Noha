{% extends 'base.html.twig' %}

{% block title %}Accueil
{% endblock %}

{% block stylesheets %}
	{{ parent() }}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
{% endblock %}


{% block body %}

	<div class="container py-4">

		{# ======================= #}
		{# ðŸ”¹ HEADER DASHBOARD #}
		{# ======================= #}
			<div class="card border-0 shadow-sm rounded-4 mb-4"> <div class="card-body py-4 px-4 d-flex justify-content-between align-items-center">

				<div class="d-flex align-items-center">
					<div class="icon-circle bg-primary bg-opacity-10 text-primary
						                            d-flex align-items-center justify-content-center me-3" style="width:60px;height:60px;border-radius:16px;">
						<i class="bi bi-clipboard-pulse fs-3"></i>
					</div>

					<div>
						<h4 class="fw-bold mb-1">Tableau de bord</h4>
						<p class="text-muted mb-0">
							Cabinet
							<span class="fw-semibold text-primary" id="nameCabinet"></span>
						</p>
					</div>
				</div>

				<div class="d-none d-md-flex align-items-center text-muted">
					<i class="bi bi-calendar-event me-2"></i>
					{{ "now"|date("d F Y") }}
				</div>

			</div>
		</div>

{# ======================= #}
{# ðŸ”¹ DASHBOARD MOBILE PRO #}
{# ======================= #}
	<div
	class="d-md-none"> {# ACTION PRINCIPALE #}
	<div class="mb-4">
		<a data-bs-toggle="modal" data-bs-target="#modalAddClient" class="text-decoration-none">
			<div class="mobile-primary-action">
				<div class="icon">
					<i class="bi bi-person-plus-fill"></i>
				</div>
				<div>
					<h5>Ajouter un patient</h5>
					<p>CrÃ©er une nouvelle fiche mÃ©dicale</p>
				</div>
			</div>
		</a>
	</div>

	{# STATS RAPIDES #}
	<div class="row g-3 mb-4">
		<div class="col-6">
			<a href="{{ path('app_fiche_client_index') }}" class="text-decoration-none">
				<div class="mobile-stat-card bg-primary">
					<i class="bi bi-people-fill"></i>
					<div class="value">{{ totalClients ?? 0 }}</div>
					<span>Patients</span>
				</div>
			</a>
		</div>

		<div class="col-6">
			<a href="{{ path('app_rdv_index') }}" class="text-decoration-none">
				<div class="mobile-stat-card bg-info">
					<i class="bi bi-calendar-week"></i>
					<div class="value">{{ totalRdv ?? 0 }}</div>
					<span>RDV</span>
				</div>
			</a>
		</div>
	</div>

	

</div>



		{# ======================= #}
		{# ðŸ”¹ DASHBOARD DESKTOP #}
		{# ======================= #}
			<div class="row g-3 d-none d-md-flex"> {% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Ajouter un patient',
            desc: 'CrÃ©er une nouvelle fiche',
            icon: 'bi-person-plus-fill',
            bg: 'bg-add',
            modal: '#modalAddClient'
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Patients',
            desc: 'GÃ©rer les dossiers',
            icon: 'bi-people-fill',
            bg: 'bg-patients',
            link: path('app_fiche_client_index'),
            badge: totalClients ?? null
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'MÃ©dicaments',
            desc: 'RÃ©fÃ©rentiel',
            icon: 'bi-capsule-pill',
            bg: 'bg-medicines',
            link: path('medicine_index')
        } %}

			{% include 'home/_dashboard/_card_desktop.html.twig' with {
            title: 'Rendez-vous',
            desc: 'Planning',
            icon: 'bi-calendar-week',
            bg: 'bg-rdv',
            link: path('app_rdv_index'),
            badge: totalRdv ?? null
        } %}

		</div>

		{# ======================= #}
		{# ðŸ”¹ RESSOURCES #}
		{# ======================= #}
			<div class="mt-5"> <h4 class="fw-bold mb-4">
				<i class="bi bi-ui-checks-grid text-primary me-2"></i>
				RÃ©fÃ©rentiels & Ressources
			</h4>

			<div class="row g-3">
				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-activity',
                color: 'text-warning',
                title: 'SymptÃ´mes',
                subtitle: 'RÃ©fÃ©rentiel clinique',
                link: path('symptome_index')
            } %}

				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-hospital',
                color: 'text-primary',
                title: 'Ã‰tablissements hospitaliers',
                subtitle: 'Recherche & consultation',
                link: path('hopital_search_page')
            } %}

				{% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-capsule-pill',
                color: 'text-danger',
                title: 'MÃ©dicaments',
                subtitle: 'CNOPS â€“ ANAM',
                link: path('medicine_index')
            } %}
            {% include 'home/_resources/_resource_card.html.twig' with {
                icon: 'bi-heart-pulse',
                color: 'text-success',
                title: 'Dispositifs Remboursables',
                subtitle: 'CNOPS â€“ ANAM',
                link: path('dispositif_search')
            } %}



			</div>
		</div>

		{{ include('home/_stats/_stats.html.twig') }}

	</div>

	{% include 'home/_modals/_add_patient.html.twig' %}
<style>
/* ===== MOBILE DASHBOARD ===== */

.mobile-primary-action {
    display: flex;
    gap: 16px;
    padding: 18px;
    border-radius: 20px;
    background: linear-gradient(135deg, #0d6efd, #4dabf7);
    color: white;
    box-shadow: 0 10px 28px rgba(13,110,253,.35);
}

.mobile-primary-action .icon {
    width: 56px;
    height: 56px;
    border-radius: 16px;
    background: rgba(255,255,255,.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.8rem;
}

.mobile-primary-action h5 {
    margin: 0;
    font-weight: 800;
}

.mobile-primary-action p {
    margin: 0;
    opacity: .85;
    font-size: .9rem;
}

/* STATS */
.mobile-stat-card {
    border-radius: 20px;
    padding: 16px;
    color: white;
    text-align: center;
    box-shadow: 0 8px 22px rgba(0,0,0,.15);
}

.mobile-stat-card i {
    font-size: 1.6rem;
    opacity: .9;
}

.mobile-stat-card .value {
    font-size: 1.8rem;
    font-weight: 800;
    margin: 6px 0;
}

/* SHORTCUTS */
.mobile-shortcut {
    background: white;
    border-radius: 18px;
    padding: 16px;
    text-align: center;
    box-shadow: 0 6px 18px rgba(0,0,0,.08);
    font-weight: 600;
}

.mobile-shortcut i {
    font-size: 1.6rem;
    display: block;
    margin-bottom: 6px;
}
</style>
{% endblock %}



{% block javascripts %}
	{{ parent() }}
 <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

	 <script>
	        document.addEventListener('DOMContentLoaded', () => {
	            const el = document.querySelector('.dashboardCoverflow');
	
	            // si on est sur desktop, le slider n'existe pas (d-none d-md-none), donc on skip
	            if (!el || typeof Swiper === "undefined") return;
	
	            new Swiper(el, {
	                effect: 'coverflow',
	                grabCursor: true,
	                centeredSlides: true,
	                slidesPerView: 'auto',
	                spaceBetween: -20,
	                coverflowEffect: {
	                    rotate: 0,
	                    stretch: 0,
	                    depth: 120,
	                    modifier: 1.4,
	                    slideShadows: false,
	                },
	            });
	        });
	    </script>

	 <script>
	        async function afficherNomCabinet() {
	            const res = await fetch("{{ path('app_nom_cabinet') }}");
	            const data = await res.json();
	            const el = document.getElementById('nameCabinet');
	            if (el) el.innerText = data.nom ?? '';
	        }
	        afficherNomCabinet();
	    </script>
{% endblock %}

