<!-- ============================= -->
<!-- ðŸŒŸ STYLE GLOBAL DU DASHBOARD -->
<!-- ============================= -->
	<style>
	/* ===============================
   ðŸ§Š EMPTY STATE RDV
=============================== */
	/* ===============================
   ðŸ“… RDV â€“ DESIGN PRO
=============================== */

	/* Carte RDV */
	.rdv-ux-card {
		background: #ffffff;
		border-radius: 18px;
		padding: 18px 20px;
		box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
		border-left: 5px solid #0d6efd;
		transition: 0.25s ease;
		height: 100%;
		position: relative;
	}

	.rdv-ux-card:hover {
		transform: translateY(-4px);
		background: #f6f9ff;
	}

	/* RDV expirÃ© */
	.rdv-expired {
		border-left-color: #dc3545;
		background: #fff5f5;
	}

	/* Date bloc */
	.rdv-date {
		font-size: 0.8rem;
		font-weight: 800;
		text-transform: uppercase;
		letter-spacing: 0.04em;
		color: #0d6efd;
	}

	.rdv-expired .rdv-date {
		color: #ffffffff;
	}

	/* Nom patient */
	.rdv-name {
		font-weight: 700;
		font-size: 1rem;
		margin-top: 6px;
		color: #212529;
	}

	/* Heure */
	.rdv-time {
		font-size: 0.9rem;
		color: #6c757d;
		margin-top: 2px;
	}

	/* Badge */
	.rdv-status {
		margin-top: 10px;
	}

	/* Bouton */
	.rdv-action-btn {
		margin-top: 14px;
	}

	/* ===============================
   ðŸš« EMPTY STATE
=============================== */
	.rdv-empty-state {
		text-align: center;
		padding: 50px 20px;
	}

	.rdv-empty-icon {
		width: 80px;
		height: 80px;
		border-radius: 22px;
		background: linear-gradient(135deg, #0d6efd, #4dabf7);
		color: #fff;
		font-size: 2.2rem;
		display: flex;
		align-items: center;
		justify-content: center;
		margin: 0 auto 20px;
		box-shadow: 0 12px 30px rgba(13, 110, 253, 0.35);
	}



.rdv-empty-state {
    background: linear-gradient(135deg, #f8faff, #eef3ff);
    border-radius: 22px;
    padding: 40px;
    text-align: center;
    box-shadow: 0 12px 30px rgba(13,110,253,0.15);
}

.rdv-empty-icon {
    width: 72px;
    height: 72px;
    border-radius: 20px;
    background: linear-gradient(135deg, #0d6efd, #4dabf7);
    color: #fff;
    font-size: 2rem;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto;
    box-shadow: 0 10px 25px rgba(13,110,253,0.35);
}

/* ===============================
   ðŸ“… RDV CARD UX
=============================== */
.rdv-ux-card {
    background: #ffffff;
    border-radius: 18px;
    padding: 18px;
    box-shadow: 0 8px 20px rgba(0,0,0,0.08);
    border-left: 4px solid #0d6efd;
    transition: .25s;
    height: 100%;
}

.rdv-ux-card:hover {
    transform: translateY(-4px);
    background: #f6f9ff;
}

.rdv-expired {
    border-left-color: #dc3545;
    background: #fff5f5;
}

.rdv-date {
    font-weight: 800;
    color: #0d6efd;
    text-transform: uppercase;
    font-size: .85rem;
}

.rdv-name {
    font-weight: 700;
    color: #212529;
}

.rdv-time {
    font-size: .9rem;
    color: #6c757d;
}
	.rdv-ux-card {
    background: #ffffff;
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    transition: .25s;
    height: 100%;
}

.rdv-ux-card:hover {
    transform: translateY(-4px);
}

.rdv-expired {
    background: #fff5f5;
    border-left: 4px solid #dc3545;
}

.rdv-date {
    background: #0d6efd;
    color: #fff;
    font-weight: 700;
    font-size: .85rem;
    display: inline-block;
    padding: 6px 12px;
    border-radius: 999px;
}

.rdv-name {
    font-weight: 700;
    color: #0d6efd;
    margin-top: 6px;
}

.rdv-time {
    font-size: .9rem;
    color: #6c757d;
}

/* Card RDV compacte */
.rdv-mini {
	background: #ffffff;
	border-left: 4px solid #0d6efd;
	border-radius: 12px;
	padding: 12px;
	box-shadow: 0 3px 10px rgba(0, 0, 0, 0.06);
	transition: 0.25s;
	height: 100%;
}

.rdv-mini:hover {
	background: #f5f8ff;
	transform: translateY(-4px);
}

/* Nom */
.rdv-mini strong {
	font-size: 0.95rem;
	color: #0d6efd;
}

/* Badge Ã©tat */
.rdv-mini .badge {
	font-size: 0.70rem;
}

/* Graph Box Style */
.chart-box {
	background: #fff;
	border-radius: 18px;
	padding: 20px;
	box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
	border: 1px solid #ececec;
}

.chart-title {
	font-weight: 700;
	color: #0d6efd;
	margin-bottom: 12px;
}
/* ---------- HEADER ---------- */
.dashboard-hero {
	background: linear-gradient(135deg, #257cfd, #0dcaf0);


	border-radius: 22px;
	padding: 40px;
	color: white;
	display: flex;
	justify-content: space-between;
	align-items: center;
	flex-wrap: wrap;
	box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.dashboard-hero img {
	width: 180px;
	object-fit: cover;
	border-radius: 20px;
	border: 4px solid rgba(255, 255, 255, 0.5);
	box-shadow: 0 8px 15px rgba(0, 0, 0, 0.25);
}


/* ---------- CARDS ---------- */
.dashboard-card {
	background: white;
	border-radius: 18px;
	padding: 25px;
	box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
	border: 1px solid #ececec;
}

/* ---------- GRAPHIQUES ---------- */
.chart-container {
	height: 200px;
	display: flex;
	justify-content: center;
	align-items: center;
}

.legend-dots {
	display: flex;
	justify-content: center;
	gap: 8px;
	flex-wrap: wrap;
}

.legend-color {
	width: 12px;
	height: 12px;
	border-radius: 50%;
}

/* ---------- RDV DESIGN ---------- */
.rdv-item {
	background: #f8faff;
	border-radius: 14px;
	padding: 15px 18px;
	border: 1px solid #e2e6f0;
	display: flex;
	justify-content: space-between;
	align-items: center;
	transition: 0.3s ease;
}

.rdv-item:hover {
	background: #eef3ff;
	transform: translateY(-2px);
}

.btn-rdv-valid {
	background: #28a745;
	border: none;
	padding: 7px 12px;
	border-radius: 40px;
	color: white;
	transition: 0.3s ease;
}

.btn-rdv-valid:hover {
	background: #218838;
}

.btn-rdv-valid:disabled {
	background: #adb5bd !important;
}

.validated-animation {
	animation: pulseCheck 0.4s ease;
}

@keyframes pulseCheck {
	0% {
		transform: scale(1);
	}
	50% {
		transform: scale(1.15);
	}
	100% {
		transform: scale(1);
	}
}
</style>




<!-- ============================= -->
<!-- ðŸ“… PROCHAINS RENDEZ-VOUS -->
<!-- ============================= -->
	<div
	class="mt-5"> <!-- TITRE -->
	<div class="d-flex align-items-center justify-content-between mb-4">
		<h4 class="fw-bold text-primary mb-0">
			<i class="bi bi-calendar-check me-2"></i>
			Prochains rendez-vous
		</h4>

		<a href="/calendrier" class="btn btn-outline-primary rounded-pill btn-sm">
			<i class="bi bi-calendar-event me-1"></i>
			Calendrier
		</a>
	</div>

	<!-- CONTENEUR RDV -->
	<div class="card border-0 shadow-sm rounded-4">
		<div
			class="card-body p-4">

			<!-- LISTE RDV (injectÃ©e en JS) -->
			<div class="row g-4" id="rdvList"></div>

		</div>
	</div>

</div>






<!-- ============================= -->
<!-- ðŸŒŸ HEADER AVEC ILLUSTRATION -->
<!-- ============================= -->
	<div class=" my-5 "> <div class="dashboard-hero">

		<div
			class="row align-items-center w-100">

			<!-- ðŸ“ TEXTE (8 colonnes) -->
			<div class="col-md-8">
				<h2 class="fw-bold mb-3">
					<i class="bi bi-speedometer2"></i>
					Tableau de bord analytique
				</h2>

				<p style="opacity: .9;">
					Analysez vos donnÃ©es en un coup dâ€™Å“il grÃ¢ce Ã  une interface moderne, claire et intuitive.
															                    Visualisez vos statistiques, suivez lâ€™Ã©volution de votre activitÃ© et gÃ©rez efficacement vos rendez-vous.
				</p>

				<div class="mt-3">
					<span class="badge bg-light text-dark mb-1 me-2 px-3 py-2 rounded-pill">
						ðŸ“Š Statistiques intelligentes
					</span>
					<span class="badge bg-light text-dark mb-1 me-2 px-3 py-2 rounded-pill">
						ðŸ”” Suivi en temps rÃ©el
					</span>
					<span class="badge bg-light text-dark mb-1 px-3 py-2 rounded-pill">
						ðŸ”’ DonnÃ©es sÃ©curisÃ©es
					</span>
				</div>
			</div>

			<!-- ðŸ–¼ï¸ IMAGE (4 colonnes) -->
			<div class="col-md-4 text-center mt-4 mt-md-0">
				<img src="/assets/img/3736765.jpg" alt="Illustration du dashboard" class="img-fluid rounded-4" style="height: 220px; width: 100%; object-fit: cover; border: 4px solid rgba(255,255,255,0.4);">
			</div>

		</div>

	</div>
</div>


<!-- ===== GRAPHIQUES ===== -->
<div class="row g-4 mt-2">

	<div class="col-12 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-cash-coin"></i>
				Type paiements
			</h5>
			<canvas id="chartPaiements"></canvas>
		</div>
	</div>

	<div class="col-12 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-heart-pulse"></i>
				Types de maladies
			</h5>
			<canvas id="chartPieMaladies"></canvas>
		</div>
	</div>

	<div class="col-12 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-thermometer"></i>
				SymptÃ´mes gÃ©nÃ©raux
			</h5>
			<canvas id="chartSymptomes"></canvas>
		</div>
	</div>

	<div class="col-12 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-pie-chart-fill"></i>
				Clients par jour
			</h5>
			<canvas id="chartClientsPerDay"></canvas>
		</div>
	</div>

</div>


 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <script>
/* ================= GLOBAL ================= */
let charts = {};

function destroyChart(id) {
    if (charts[id]) {
        charts[id].destroy();
        delete charts[id];
    }
}

/* ================= GRAPHIQUES ================= */

// ðŸ’³ Paiements â†’ BAR HORIZONTAL
async function loadPaiementsChart() {
    const res = await fetch('/api/statistics/paiements');
    const stats = await res.json();

    destroyChart('paiements');

    charts.paiements = new Chart(document.getElementById('chartPaiements'), {
        type: 'bar',
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.values,
                backgroundColor: 'rgba(13,110,253,.8)',
                borderRadius: 12
            }]
        },
        options: {
            indexAxis: 'y',
            plugins: { legend: { display: false } },
            scales: {
                x: { grid: { display: false } },
                y: { grid: { display: false } }
            }
        }
    });
}

// â¤ï¸ Maladies â†’ DOUGHNUT Ã‰PAIS
async function loadMaladiesChart() {
    const res = await fetch("{{ path('api_statistics_maladies') }}");
    const stats = await res.json();

    destroyChart('maladies');

    charts.maladies = new Chart(document.getElementById('chartPieMaladies'), {
        type: 'doughnut',
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.values,
                backgroundColor: [
                    '#0d6efd','#20c997','#ffc107','#dc3545','#6f42c1'
                ],
                borderWidth: 0
            }]
        },
        options: {
            cutout: '70%',
            plugins: { legend: { position: 'bottom' } }
        }
    });
}

// ðŸŒ¡ï¸ SymptÃ´mes â†’ RADAR
async function loadSymptomesChart() {
    const res = await fetch("{{ path('api_statistics_symptomes') }}");
    const stats = await res.json();

    destroyChart('symptomes');

    charts.symptomes = new Chart(document.getElementById('chartSymptomes'), {
        type: 'radar',
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.values,
                backgroundColor: 'rgba(13,110,253,.2)',
                borderColor: '#0d6efd',
                pointBackgroundColor: '#0d6efd'
            }]
        },
        options: {
            plugins: { legend: { display: false } }
        }
    });
}

// ðŸ“ˆ Clients / jour â†’ LINE GRADIENT
async function loadClientsPerDayChart() {
    const res = await fetch('/api/statistics/clients-per-day');
    const stats = await res.json();

    destroyChart('clients');

    const ctx = document.getElementById('chartClientsPerDay').getContext('2d');
    const gradient = ctx.createLinearGradient(0,0,0,200);
    gradient.addColorStop(0,'rgba(13,110,253,.5)');
    gradient.addColorStop(1,'rgba(13,110,253,0)');

    charts.clients = new Chart(ctx, {
        type: 'line',
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.values,
                fill: true,
                backgroundColor: gradient,
                borderColor: '#0d6efd',
                tension: .4
            }]
        },
        options: {
            plugins: { legend: { display: false } },
            scales: {
                x: { grid: { display: false } },
                y: { grid: { display: false } }
            }
        }
    });
}


/* ================= INIT ================= */
document.addEventListener('DOMContentLoaded', () => {
    loadPaiementsChart();
    loadMaladiesChart();
    loadSymptomesChart();
    loadClientsPerDayChart();
    loadNextRDV();
});
</script>

 <script>
async function loadAllRDV() {
    const res = await fetch('/api/rendezvous/events');
    const rdvs = await res.json();
    const container = document.getElementById('rdvList');

    container.innerHTML = '';
    const now = new Date();

    // ðŸ”¹ uniquement les RDV confirmÃ©s
    const confirmes = rdvs.filter(
        rdv => rdv.extendedProps.statut === 'confirme'
    );

    /* ===============================
     * ðŸš« AUCUN RDV â†’ EMPTY STATE PRO
     * =============================== */
    if (confirmes.length === 0) {
        container.innerHTML = `
            <div class="col-12">
                <div class="rdv-empty-state">
                    <div class="rdv-empty-icon">
                        <i class="bi bi-calendar-x"></i>
                    </div>

                    <h5 class="fw-bold mt-3">
                        Aucun rendez-vous programmÃ©
                    </h5>

                    <p class="text-muted mb-4">
                        Vous nâ€™avez actuellement aucun rendez-vous confirmÃ©.<br>
                        Consultez le calendrier pour voir lâ€™historique ou planifier.
                    </p>

                    <a href="/calendrier" class="btn btn-primary rounded-pill px-4">
                        <i class="bi bi-calendar-event me-1"></i>
                        Voir le calendrier
                    </a>
                </div>
            </div>
        `;
        return;
    }

    /* ===============================
     * âœ… LISTE DES RDV
     * =============================== */
    confirmes.forEach(rdv => {

        const expiresAt = new Date(rdv.extendedProps.expiresAt);
        const isExpired = expiresAt < now;

        const start = new Date(rdv.start);

        const dateLabel = start.toLocaleDateString('fr-FR', {
            weekday: 'short',
            day: '2-digit',
            month: 'short'
        });

        const timeLabel = start.toLocaleTimeString('fr-FR', {
            hour: '2-digit',
            minute: '2-digit'
        });

        container.insertAdjacentHTML('beforeend', `
            <div class="col-md-6 col-lg-4">
                <div class="rdv-ux-card ${isExpired ? 'rdv-expired' : ''}">

                    <!-- DATE -->
                    <div class="rdv-date">
                        ${dateLabel}
                    </div>

                    <!-- INFOS -->
                    <div class="mt-2">
                        <div class="rdv-name">
                            <i class="bi bi-person-circle"></i>
                            ${rdv.title}
                        </div>

                        <div class="rdv-time">
                            <i class="bi bi-clock"></i>
                            ${timeLabel}
                        </div>
                    </div>

                    <!-- STATUT -->
                    <div class="mt-2">
                        ${
                            isExpired
                            ? `<span class="badge bg-danger">Rendez-vous ratÃ©</span>`
                            : `<span class="badge bg-success">Ã€ venir</span>`
                        }
                    </div>

                    <!-- ACTION -->
                    <button
                        class="btn btn-sm ${isExpired ? 'btn-danger' : 'btn-success'} w-100 mt-3"
                        onclick="validerRDV(${rdv.id})">
                        <i class="bi bi-check-circle"></i>
                        ${isExpired ? 'Archiver' : 'Valider'}
                    </button>
                </div>
            </div>
        `);
    });
}

async function validerRDV(id) {
    if (!confirm('Confirmer cette action ?')) return;
    await fetch(`/api/rendezvous/${id}/valider`, { method: 'POST' });
    loadAllRDV();
}

document.addEventListener('DOMContentLoaded', loadAllRDV);
</script>







