<!-- ============================= -->
<!-- ðŸŒŸ STYLE GLOBAL DU DASHBOARD -->
<!-- ============================= -->
	<style>
/* Card RDV compacte */
.rdv-mini {
    background: #ffffff;
    border-left: 4px solid #0d6efd;
    border-radius: 12px;
    padding: 12px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.06);
    transition:.25s;
    height: 100%;
}

.rdv-mini:hover {
    background: #f5f8ff;
    transform: translateY(-4px);
}

/* Nom */
.rdv-mini strong {
    font-size: .95rem;
    color:#0d6efd;
}

/* Badge Ã©tat */
.rdv-mini .badge {
    font-size:.70rem;
}

/* Graph Box Style */
.chart-box {
    background: #fff;
    border-radius: 18px;
    padding: 20px;
    box-shadow: 0 8px 18px rgba(0,0,0,0.08);
    border: 1px solid #ececec;
}

.chart-title {
    font-weight: 700;
    color: #0d6efd;
    margin-bottom: 12px;
}
/* ---------- HEADER ---------- */
.dashboard-hero {
background: linear-gradient(135deg, #257cfd, #0dcaf0);




	border-radius: 22px;
	padding: 40px;
	color: white;
	display: flex;
	justify-content: space-between;
	align-items: center;
	flex-wrap: wrap;
	box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
}

.dashboard-hero img {
	width: 180px;
	object-fit: cover;
	border-radius: 20px;
	border: 4px solid rgba(255, 255, 255, 0.5);
	box-shadow: 0 8px 15px rgba(0, 0, 0, 0.25);
}



/* ---------- CARDS ---------- */
.dashboard-card {
	background: white;
	border-radius: 18px;
	padding: 25px;
	box-shadow: 0 8px 18px rgba(0, 0, 0, 0.08);
	border: 1px solid #ececec;
}

/* ---------- GRAPHIQUES ---------- */
.chart-container {
	height: 200px;
	display: flex;
	justify-content: center;
	align-items: center;
}

.legend-dots {
	display: flex;
	justify-content: center;
	gap: 8px;
	flex-wrap: wrap;
}

.legend-color {
	width: 12px;
	height: 12px;
	border-radius: 50%;
}

/* ---------- RDV DESIGN ---------- */
.rdv-item {
	background: #f8faff;
	border-radius: 14px;
	padding: 15px 18px;
	border: 1px solid #e2e6f0;
	display: flex;
	justify-content: space-between;
	align-items: center;
	transition: 0.3s ease;
}

.rdv-item:hover {
	background: #eef3ff;
	transform: translateY(-2px);
}

.btn-rdv-valid {
	background: #28a745;
	border: none;
	padding: 7px 12px;
	border-radius: 40px;
	color: white;
	transition: 0.3s ease;
}

.btn-rdv-valid:hover {
	background: #218838;
}

.btn-rdv-valid:disabled {
	background: #adb5bd !important;
}

.validated-animation {
	animation: pulseCheck 0.4s ease;
}

@keyframes pulseCheck {
	0% {
		transform: scale(1);
	}
	50% {
		transform: scale(1.15);
	}
	100% {
		transform: scale(1);
	}
}
.rdv-card {
    background: #ffffff;
    border-left: 4px solid #0d6efd;
    border-radius: 14px;
    padding: 14px;
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    transition: .25s;
}

.rdv-card:hover {
    transform: translateY(-4px);
    background: #f6f9ff;
}

.rdv-name {
    font-weight: 700;
    color: #0d6efd;
}

.rdv-time {
    font-size: .9rem;
    color: #6c757d;
}
</style>


<!-- ============================= -->
<!-- ðŸ“… PROCHAINS RENDEZ-VOUS -->
<!-- ============================= -->
	<div
	class="mt-5"> <!-- ðŸŽ¯ TITRE -->
	<h4 class="fw-bold text-primary mb-4">
		<i class="bi bi-calendar-event me-2"></i>
		Prochains rendez-vous
	</h4>

	<div
		class="row g-4 align-items-stretch">

		<!-- ðŸ–¼ï¸ ILLUSTRATION (desktop uniquement) -->
		<div class="col-lg-4 d-none d-lg-block">
			<img src="{{ asset('/assets/img/3943280.jpg') }}" alt="Illustration rendez-vous" class="rounded-4 shadow-sm w-100" style="height: 100%; object-fit: cover;">
		</div>

		<!-- ðŸŸ¦ LISTE DES RDV -->
		<div class="col-lg-8">
			<div
				class="row g-3" id="rdvList">{# RDV injectÃ©s en JS #}
			</div>
		</div>

	</div>

</div>





 <script>
async function loadNextRDV() {
    const res = await fetch('/api/rendezvous/next');
    const rdvs = await res.json();
    const container = document.getElementById('rdvList');

    container.innerHTML = '';

    if (rdvs.length === 0) {
        container.innerHTML = `
            <div class="col-12 text-muted text-center">
                Aucun rendez-vous Ã  venir
            </div>
        `;
        return;
    }

    rdvs.forEach(rdv => {
        container.insertAdjacentHTML('beforeend', `
            <div class="col-md-6 col-lg-6">
                <div class="rdv-card h-100">
                    <div class="rdv-name">
                        <i class="bi bi-person-circle me-1"></i>
                        ${rdv.nom}
                    </div>

                    <div class="rdv-time mt-1">
                        <i class="bi bi-clock me-1"></i>
                        ${rdv.date} Ã  ${rdv.heure}
                    </div>

                    <button class="btn btn-sm btn-outline-danger rounded-pill mt-3 w-100"
                        onclick="annulerRDV(${rdv.id})">
                        <i class="bi bi-x-circle"></i>
                        Annuler
                    </button>
                </div>
            </div>
        `);
    });
}

async function annulerRDV(id) {
    if (!confirm('Annuler ce rendez-vous ?')) return;

    await fetch(`/api/rendezvous/${id}/annuler`, {
        method: 'POST'
    });

    loadNextRDV();
}

document.addEventListener('DOMContentLoaded', loadNextRDV);
</script>



<!-- ============================= -->
<!-- ðŸŒŸ HEADER AVEC ILLUSTRATION -->
<!-- ============================= -->
	<div class=" my-5 "> <div class="dashboard-hero">

		<div
			class="row align-items-center w-100">

			<!-- ðŸ“ TEXTE (8 colonnes) -->
			<div class="col-md-8">
				<h2 class="fw-bold mb-3">
					<i class="bi bi-speedometer2"></i>
					Tableau de bord analytique
				</h2>

				<p style="opacity: .9;">
					Analysez vos donnÃ©es en un coup dâ€™Å“il grÃ¢ce Ã  une interface moderne, claire et intuitive.
										                    Visualisez vos statistiques, suivez lâ€™Ã©volution de votre activitÃ© et gÃ©rez efficacement vos rendez-vous.
				</p>

				<div class="mt-3">
					<span class="badge bg-light text-dark mb-1 me-2 px-3 py-2 rounded-pill">
						ðŸ“Š Statistiques intelligentes
					</span>
					<span class="badge bg-light text-dark mb-1 me-2 px-3 py-2 rounded-pill">
						ðŸ”” Suivi en temps rÃ©el
					</span>
					<span class="badge bg-light text-dark mb-1 px-3 py-2 rounded-pill">
						ðŸ”’ DonnÃ©es sÃ©curisÃ©es
					</span>
				</div>
			</div>

			<!-- ðŸ–¼ï¸ IMAGE (4 colonnes) -->
			<div class="col-md-4 text-center mt-4 mt-md-0">
				<img src="/assets/img/3736765.jpg" alt="Illustration du dashboard" class="img-fluid rounded-4" style="height: 220px; width: 100%; object-fit: cover; border: 4px solid rgba(255,255,255,0.4);">
			</div>

		</div>

	</div>
</div>



<!-- ===== GRAPHIQUES ===== -->
<div class="row g-4 mt-2">

	<div class="col-6 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-cash-coin"></i>
				Type paiements
			</h5>
			<canvas id="chartPaiements"></canvas>
		</div>
	</div>

	<div class="col-6 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-heart-pulse"></i>
				Types de maladies
			</h5>
			<canvas id="chartPieMaladies"></canvas>
		</div>
	</div>

	<div class="col-6 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-thermometer"></i>
				SymptÃ´mes gÃ©nÃ©raux
			</h5>
			<canvas id="chartSymptomes"></canvas>
		</div>
	</div>

	<div class="col-6 col-lg-3">
		<div class="chart-box">
			<h5 class="chart-title">
				<i class="bi bi-pie-chart-fill"></i>
				Clients par jour
			</h5>
			<canvas id="chartClientsPerDay"></canvas>
		</div>
	</div>

</div>




<!-- ============================= -->
<!-- ðŸ“Š CHART JS SCRIPTS -->
<!-- ============================= -->
 <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

 <script>

/* ----- TOOLTIP ----- */
const tooltipLabel = ctx => ctx.label + " : " + ctx.raw;


/* ----- CHARTS ----- */
async function loadPaiementsChart() {
    const res = await fetch("/api/statistics/paiements");
    const stats = await res.json();

    const colors = [
        "rgba(13,110,253,0.8)",
        "rgba(25,135,84,0.8)",
        "rgba(255,193,7,0.8)",
        "rgba(220,53,69,0.8)",
        "rgba(108,117,125,0.8)"
    ];

    new Chart(document.getElementById("chartPaiements"), {
        type: "pie",
        data: { labels: stats.labels, datasets: [{ data: stats.values, backgroundColor: colors }] },
        options: { plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabel } } } }
    });

}

async function loadMaladiesChart() {
    const res = await fetch("{{ path('api_statistics_maladies') }}");
    const stats = await res.json();

    const colors = [
        'rgba(255,99,132,0.8)','rgba(54,162,235,0.8)','rgba(255,206,86,0.8)',
        'rgba(75,192,192,0.8)','rgba(153,102,255,0.8)','rgba(255,159,64,0.8)'
    ];

    new Chart(document.getElementById("chartPieMaladies"), {
        type: "pie",
        data: { labels: stats.labels, datasets: [{ data: stats.values, backgroundColor: colors }] },
        options: { plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabel } } } }
    });

}

async function loadSymptomesChart() {
    const res = await fetch("{{ path('api_statistics_symptomes') }}");
    const stats = await res.json();

    const colors = [
        'rgba(255,99,132,0.8)','rgba(54,162,235,0.8)','rgba(255,206,86,0.8)'
    ];

    new Chart(document.getElementById("chartSymptomes"), {
        type: "pie",
        data: { labels: stats.labels, datasets: [{ data: stats.values, backgroundColor: colors }] },
        options: { plugins: { legend: { display: false }, tooltip: { callbacks: { label: tooltipLabel } } } }
    });

}

async function loadClientsPerDayChart() {
    const res = await fetch("/api/statistics/clients-per-day");
    const stats = await res.json();

    const colors = [
        "rgba(13,110,253,0.8)",
        "rgba(25,135,84,0.8)",
        "rgba(255,193,7,0.8)",
        "rgba(220,53,69,0.8)",
        "rgba(108,117,125,0.8)",
        "rgba(111,66,193,0.8)" 
    ];

    new Chart(document.getElementById("chartClientsPerDay"), {
        type: "pie",
        data: {
            labels: stats.labels,
            datasets: [{
                data: stats.values,
                backgroundColor: colors.slice(0, stats.values.length)
            }]
        },
        options: {
            plugins: {
                legend: { display: false },
                tooltip: { callbacks: { label: ctx => ctx.label + " : " + ctx.raw } }
            }
        }
    });

}


/* ----- RDV ----- */
async function loadRDV() {
    const res = await fetch("/api/rdv/today");
    const rdvs = await res.json();
    const row = document.getElementById("rdvRow");

    row.innerHTML = "";

    if (rdvs.length === 0) {
        row.innerHTML = `<p class="text-muted text-center">Aucun rendez-vous aujourdâ€™hui</p>`;
        return;
    }

    // Afficher max 6 RDV
rdvs.slice(0, 4).forEach(rdv => {




    row.insertAdjacentHTML("beforeend", `
        <div class="col-6 col-md-4 col-lg-6">
            <div class="rdv-mini">
                <strong><i class="bi bi-person-circle"></i> ${rdv.nom}</strong><br>
                <small class="text-muted">
                    <i class="bi bi-chat-left-text"></i>
                    ${rdv.motif ?? "Sans motif"}
                </small>
                <div class="mt-1">
                    <span class="badge bg-success">${rdv.statut}</span>
                </div>
                <small class="text-muted d-block mt-1">
                    <i class="bi bi-clock"></i> ${rdv.date}
                </small>
<button class="clicSound btn btn-sm btn-success rounded-pill mt-2 btn-validate-rdv" data-id="${rdv.id}" id="btn-rdv-${rdv.id}">


                    <i class="bi bi-check-circle"></i>
                </button>
            </div>
        </div>
    `);
	   // ðŸ”Š ACTIVER LE SON ICI
    buttonSoundClick(`btn-rdv-${rdv.id}`, "disabled");
});

attachValidationEvents();

}


function attachValidationEvents() {
    document.querySelectorAll(".btn-validate-rdv").forEach(btn => {
        btn.addEventListener("click", async e => {
            e.preventDefault();
            const id = btn.dataset.id;

            const res = await fetch(`/api/rdv/validate/${id}`, { method: "POST" });
            const data = await res.json();

            if (data.success) {
                btn.classList.add("validated-animation");
                btn.innerHTML = `<i class="bi bi-check-circle-fill"></i>`;
                btn.disabled = true;

                setTimeout(() => loadRDV(), 300);
            }
        });
    });
}

document.addEventListener("DOMContentLoaded", () => {
    loadPaiementsChart();
    loadMaladiesChart();
    loadSymptomesChart();
    loadClientsPerDayChart();
    loadRDV();
});

</script>

